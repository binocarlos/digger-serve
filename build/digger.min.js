/* SockJS client, version 0.3.4, http://sockjs.org, MIT License

Copyright (c) 2011-2012 VMware, Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/

// JSON2 by Douglas Crockford (minified).
var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g;return e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return a<10?"0"+a:a}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}()

SockJS=function(){var a=document,b=window,c={},d=function(){};d.prototype.addEventListener=function(a,b){this._listeners||(this._listeners={}),a in this._listeners||(this._listeners[a]=[]);var d=this._listeners[a];c.arrIndexOf(d,b)===-1&&d.push(b);return},d.prototype.removeEventListener=function(a,b){if(!(this._listeners&&a in this._listeners))return;var d=this._listeners[a],e=c.arrIndexOf(d,b);if(e!==-1){d.length>1?this._listeners[a]=d.slice(0,e).concat(d.slice(e+1)):delete this._listeners[a];return}return},d.prototype.dispatchEvent=function(a){var b=a.type,c=Array.prototype.slice.call(arguments,0);this["on"+b]&&this["on"+b].apply(this,c);if(this._listeners&&b in this._listeners)for(var d=0;d<this._listeners[b].length;d++)this._listeners[b][d].apply(this,c)};var e=function(a,b){this.type=a;if(typeof b!="undefined")for(var c in b){if(!b.hasOwnProperty(c))continue;this[c]=b[c]}};e.prototype.toString=function(){var a=[];for(var b in this){if(!this.hasOwnProperty(b))continue;var c=this[b];typeof c=="function"&&(c="[function]"),a.push(b+"="+c)}return"SimpleEvent("+a.join(", ")+")"};var f=function(a){var b=this;b._events=a||[],b._listeners={}};f.prototype.emit=function(a){var b=this;b._verifyType(a);if(b._nuked)return;var c=Array.prototype.slice.call(arguments,1);b["on"+a]&&b["on"+a].apply(b,c);if(a in b._listeners)for(var d=0;d<b._listeners[a].length;d++)b._listeners[a][d].apply(b,c)},f.prototype.on=function(a,b){var c=this;c._verifyType(a);if(c._nuked)return;a in c._listeners||(c._listeners[a]=[]),c._listeners[a].push(b)},f.prototype._verifyType=function(a){var b=this;c.arrIndexOf(b._events,a)===-1&&c.log("Event "+JSON.stringify(a)+" not listed "+JSON.stringify(b._events)+" in "+b)},f.prototype.nuke=function(){var a=this;a._nuked=!0;for(var b=0;b<a._events.length;b++)delete a[a._events[b]];a._listeners={}};var g="abcdefghijklmnopqrstuvwxyz0123456789_";c.random_string=function(a,b){b=b||g.length;var c,d=[];for(c=0;c<a;c++)d.push(g.substr(Math.floor(Math.random()*b),1));return d.join("")},c.random_number=function(a){return Math.floor(Math.random()*a)},c.random_number_string=function(a){var b=(""+(a-1)).length,d=Array(b+1).join("0");return(d+c.random_number(a)).slice(-b)},c.getOrigin=function(a){a+="/";var b=a.split("/").slice(0,3);return b.join("/")},c.isSameOriginUrl=function(a,c){return c||(c=b.location.href),a.split("/").slice(0,3).join("/")===c.split("/").slice(0,3).join("/")},c.getParentDomain=function(a){if(/^[0-9.]*$/.test(a))return a;if(/^\[/.test(a))return a;if(!/[.]/.test(a))return a;var b=a.split(".").slice(1);return b.join(".")},c.objectExtend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};var h="_jp";c.polluteGlobalNamespace=function(){h in b||(b[h]={})},c.closeFrame=function(a,b){return"c"+JSON.stringify([a,b])},c.userSetCode=function(a){return a===1e3||a>=3e3&&a<=4999},c.countRTO=function(a){var b;return a>100?b=3*a:b=a+200,b},c.log=function(){b.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},c.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}},c.flatUrl=function(a){return a.indexOf("?")===-1&&a.indexOf("#")===-1},c.amendUrl=function(b){var d=a.location;if(!b)throw new Error("Wrong url for SockJS");if(!c.flatUrl(b))throw new Error("Only basic urls are supported in SockJS");return b.indexOf("//")===0&&(b=d.protocol+b),b.indexOf("/")===0&&(b=d.protocol+"//"+d.host+b),b=b.replace(/[/]+$/,""),b},c.arrIndexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},c.arrSkip=function(a,b){var d=c.arrIndexOf(a,b);if(d===-1)return a.slice();var e=a.slice(0,d);return e.concat(a.slice(d+1))},c.isArray=Array.isArray||function(a){return{}.toString.call(a).indexOf("Array")>=0},c.delay=function(a,b){return typeof a=="function"&&(b=a,a=0),setTimeout(b,a)};var i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j={"\0":"\\u0000","\x01":"\\u0001","\x02":"\\u0002","\x03":"\\u0003","\x04":"\\u0004","\x05":"\\u0005","\x06":"\\u0006","\x07":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\x0b":"\\u000b","\f":"\\f","\r":"\\r","\x0e":"\\u000e","\x0f":"\\u000f","\x10":"\\u0010","\x11":"\\u0011","\x12":"\\u0012","\x13":"\\u0013","\x14":"\\u0014","\x15":"\\u0015","\x16":"\\u0016","\x17":"\\u0017","\x18":"\\u0018","\x19":"\\u0019","\x1a":"\\u001a","\x1b":"\\u001b","\x1c":"\\u001c","\x1d":"\\u001d","\x1e":"\\u001e","\x1f":"\\u001f",'"':'\\"',"\\":"\\\\","\x7f":"\\u007f","\x80":"\\u0080","\x81":"\\u0081","\x82":"\\u0082","\x83":"\\u0083","\x84":"\\u0084","\x85":"\\u0085","\x86":"\\u0086","\x87":"\\u0087","\x88":"\\u0088","\x89":"\\u0089","\x8a":"\\u008a","\x8b":"\\u008b","\x8c":"\\u008c","\x8d":"\\u008d","\x8e":"\\u008e","\x8f":"\\u008f","\x90":"\\u0090","\x91":"\\u0091","\x92":"\\u0092","\x93":"\\u0093","\x94":"\\u0094","\x95":"\\u0095","\x96":"\\u0096","\x97":"\\u0097","\x98":"\\u0098","\x99":"\\u0099","\x9a":"\\u009a","\x9b":"\\u009b","\x9c":"\\u009c","\x9d":"\\u009d","\x9e":"\\u009e","\x9f":"\\u009f","\xad":"\\u00ad","\u0600":"\\u0600","\u0601":"\\u0601","\u0602":"\\u0602","\u0603":"\\u0603","\u0604":"\\u0604","\u070f":"\\u070f","\u17b4":"\\u17b4","\u17b5":"\\u17b5","\u200c":"\\u200c","\u200d":"\\u200d","\u200e":"\\u200e","\u200f":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","\u202a":"\\u202a","\u202b":"\\u202b","\u202c":"\\u202c","\u202d":"\\u202d","\u202e":"\\u202e","\u202f":"\\u202f","\u2060":"\\u2060","\u2061":"\\u2061","\u2062":"\\u2062","\u2063":"\\u2063","\u2064":"\\u2064","\u2065":"\\u2065","\u2066":"\\u2066","\u2067":"\\u2067","\u2068":"\\u2068","\u2069":"\\u2069","\u206a":"\\u206a","\u206b":"\\u206b","\u206c":"\\u206c","\u206d":"\\u206d","\u206e":"\\u206e","\u206f":"\\u206f","\ufeff":"\\ufeff","\ufff0":"\\ufff0","\ufff1":"\\ufff1","\ufff2":"\\ufff2","\ufff3":"\\ufff3","\ufff4":"\\ufff4","\ufff5":"\\ufff5","\ufff6":"\\ufff6","\ufff7":"\\ufff7","\ufff8":"\\ufff8","\ufff9":"\\ufff9","\ufffa":"\\ufffa","\ufffb":"\\ufffb","\ufffc":"\\ufffc","\ufffd":"\\ufffd","\ufffe":"\\ufffe","\uffff":"\\uffff"},k=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,l,m=JSON&&JSON.stringify||function(a){return i.lastIndex=0,i.test(a)&&(a=a.replace(i,function(a){return j[a]})),'"'+a+'"'},n=function(a){var b,c={},d=[];for(b=0;b<65536;b++)d.push(String.fromCharCode(b));return a.lastIndex=0,d.join("").replace(a,function(a){return c[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),a.lastIndex=0,c};c.quote=function(a){var b=m(a);return k.lastIndex=0,k.test(b)?(l||(l=n(k)),b.replace(k,function(a){return l[a]})):b};var o=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];c.probeProtocols=function(){var a={};for(var b=0;b<o.length;b++){var c=o[b];a[c]=y[c]&&y[c].enabled()}return a},c.detectProtocols=function(a,b,c){var d={},e=[];b||(b=o);for(var f=0;f<b.length;f++){var g=b[f];d[g]=a[g]}var h=function(a){var b=a.shift();d[b]?e.push(b):a.length>0&&h(a)};return c.websocket!==!1&&h(["websocket"]),d["xhr-streaming"]&&!c.null_origin?e.push("xhr-streaming"):d["xdr-streaming"]&&!c.cookie_needed&&!c.null_origin?e.push("xdr-streaming"):h(["iframe-eventsource","iframe-htmlfile"]),d["xhr-polling"]&&!c.null_origin?e.push("xhr-polling"):d["xdr-polling"]&&!c.cookie_needed&&!c.null_origin?e.push("xdr-polling"):h(["iframe-xhr-polling","jsonp-polling"]),e};var p="_sockjs_global";c.createHook=function(){var a="a"+c.random_string(8);if(!(p in b)){var d={};b[p]=function(a){return a in d||(d[a]={id:a,del:function(){delete d[a]}}),d[a]}}return b[p](a)},c.attachMessage=function(a){c.attachEvent("message",a)},c.attachEvent=function(c,d){typeof b.addEventListener!="undefined"?b.addEventListener(c,d,!1):(a.attachEvent("on"+c,d),b.attachEvent("on"+c,d))},c.detachMessage=function(a){c.detachEvent("message",a)},c.detachEvent=function(c,d){typeof b.addEventListener!="undefined"?b.removeEventListener(c,d,!1):(a.detachEvent("on"+c,d),b.detachEvent("on"+c,d))};var q={},r=!1,s=function(){for(var a in q)q[a](),delete q[a]},t=function(){if(r)return;r=!0,s()};c.attachEvent("unload",t),c.unload_add=function(a){var b=c.random_string(8);return q[b]=a,r&&c.delay(s),b},c.unload_del=function(a){a in q&&delete q[a]},c.createIframe=function(b,d){var e=a.createElement("iframe"),f,g,h=function(){clearTimeout(f);try{e.onload=null}catch(a){}e.onerror=null},i=function(){e&&(h(),setTimeout(function(){e&&e.parentNode.removeChild(e),e=null},0),c.unload_del(g))},j=function(a){e&&(i(),d(a))},k=function(a,b){try{e&&e.contentWindow&&e.contentWindow.postMessage(a,b)}catch(c){}};return e.src=b,e.style.display="none",e.style.position="absolute",e.onerror=function(){j("onerror")},e.onload=function(){clearTimeout(f),f=setTimeout(function(){j("onload timeout")},2e3)},a.body.appendChild(e),f=setTimeout(function(){j("timeout")},15e3),g=c.unload_add(i),{post:k,cleanup:i,loaded:h}},c.createHtmlfile=function(a,d){var e=new ActiveXObject("htmlfile"),f,g,i,j=function(){clearTimeout(f)},k=function(){e&&(j(),c.unload_del(g),i.parentNode.removeChild(i),i=e=null,CollectGarbage())},l=function(a){e&&(k(),d(a))},m=function(a,b){try{i&&i.contentWindow&&i.contentWindow.postMessage(a,b)}catch(c){}};e.open(),e.write('<html><script>document.domain="'+document.domain+'";'+"</s"+"cript></html>"),e.close(),e.parentWindow[h]=b[h];var n=e.createElement("div");return e.body.appendChild(n),i=e.createElement("iframe"),n.appendChild(i),i.src=a,f=setTimeout(function(){l("timeout")},15e3),g=c.unload_add(k),{post:m,cleanup:k,loaded:j}};var u=function(){};u.prototype=new f(["chunk","finish"]),u.prototype._start=function(a,d,e,f){var g=this;try{g.xhr=new XMLHttpRequest}catch(h){}if(!g.xhr)try{g.xhr=new b.ActiveXObject("Microsoft.XMLHTTP")}catch(h){}if(b.ActiveXObject||b.XDomainRequest)d+=(d.indexOf("?")===-1?"?":"&")+"t="+ +(new Date);g.unload_ref=c.unload_add(function(){g._cleanup(!0)});try{g.xhr.open(a,d,!0)}catch(i){g.emit("finish",0,""),g._cleanup();return}if(!f||!f.no_credentials)g.xhr.withCredentials="true";if(f&&f.headers)for(var j in f.headers)g.xhr.setRequestHeader(j,f.headers[j]);g.xhr.onreadystatechange=function(){if(g.xhr){var a=g.xhr;switch(a.readyState){case 3:try{var b=a.status,c=a.responseText}catch(a){}b===1223&&(b=204),c&&c.length>0&&g.emit("chunk",b,c);break;case 4:var b=a.status;b===1223&&(b=204),g.emit("finish",b,a.responseText),g._cleanup(!1)}}},g.xhr.send(e)},u.prototype._cleanup=function(a){var b=this;if(!b.xhr)return;c.unload_del(b.unload_ref),b.xhr.onreadystatechange=function(){};if(a)try{b.xhr.abort()}catch(d){}b.unload_ref=b.xhr=null},u.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)};var v=c.XHRCorsObject=function(){var a=this,b=arguments;c.delay(function(){a._start.apply(a,b)})};v.prototype=new u;var w=c.XHRLocalObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d,{no_credentials:!0})})};w.prototype=new u;var x=c.XDRObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d)})};x.prototype=new f(["chunk","finish"]),x.prototype._start=function(a,b,d){var e=this,f=new XDomainRequest;b+=(b.indexOf("?")===-1?"?":"&")+"t="+ +(new Date);var g=f.ontimeout=f.onerror=function(){e.emit("finish",0,""),e._cleanup(!1)};f.onprogress=function(){e.emit("chunk",200,f.responseText)},f.onload=function(){e.emit("finish",200,f.responseText),e._cleanup(!1)},e.xdr=f,e.unload_ref=c.unload_add(function(){e._cleanup(!0)});try{e.xdr.open(a,b),e.xdr.send(d)}catch(h){g()}},x.prototype._cleanup=function(a){var b=this;if(!b.xdr)return;c.unload_del(b.unload_ref),b.xdr.ontimeout=b.xdr.onerror=b.xdr.onprogress=b.xdr.onload=null;if(a)try{b.xdr.abort()}catch(d){}b.unload_ref=b.xdr=null},x.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)},c.isXHRCorsCapable=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:b.XDomainRequest&&a.domain?2:L.enabled()?3:4};var y=function(a,d,e){if(this===b)return new y(a,d,e);var f=this,g;f._options={devel:!1,debug:!1,protocols_whitelist:[],info:undefined,rtt:undefined},e&&c.objectExtend(f._options,e),f._base_url=c.amendUrl(a),f._server=f._options.server||c.random_number_string(1e3),f._options.protocols_whitelist&&f._options.protocols_whitelist.length?g=f._options.protocols_whitelist:(typeof d=="string"&&d.length>0?g=[d]:c.isArray(d)?g=d:g=null,g&&f._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),f._protocols=[],f.protocol=null,f.readyState=y.CONNECTING,f._ir=S(f._base_url),f._ir.onfinish=function(a,b){f._ir=null,a?(f._options.info&&(a=c.objectExtend(a,f._options.info)),f._options.rtt&&(b=f._options.rtt),f._applyInfo(a,b,g),f._didClose()):f._didClose(1002,"Can't connect to server",!0)}};y.prototype=new d,y.version="0.3.4",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&c.log.apply(c,arguments)},y.prototype._dispatchOpen=function(){var a=this;a.readyState===y.CONNECTING?(a._transport_tref&&(clearTimeout(a._transport_tref),a._transport_tref=null),a.readyState=y.OPEN,a.dispatchEvent(new e("open"))):a._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(a){var b=this;if(b.readyState!==y.OPEN)return;b.dispatchEvent(new e("message",{data:a}))},y.prototype._dispatchHeartbeat=function(a){var b=this;if(b.readyState!==y.OPEN)return;b.dispatchEvent(new e("heartbeat",{}))},y.prototype._didClose=function(a,b,d){var f=this;if(f.readyState!==y.CONNECTING&&f.readyState!==y.OPEN&&f.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");f._ir&&(f._ir.nuke(),f._ir=null),f._transport&&(f._transport.doCleanup(),f._transport=null);var g=new e("close",{code:a,reason:b,wasClean:c.userSetCode(a)});if(!c.userSetCode(a)&&f.readyState===y.CONNECTING&&!d){if(f._try_next_protocol(g))return;g=new e("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:g})}f.readyState=y.CLOSED,c.delay(function(){f.dispatchEvent(g)})},y.prototype._didMessage=function(a){var b=this,c=a.slice(0,1);switch(c){case"o":b._dispatchOpen();break;case"a":var d=JSON.parse(a.slice(1)||"[]");for(var e=0;e<d.length;e++)b._dispatchMessage(d[e]);break;case"m":var d=JSON.parse(a.slice(1)||"null");b._dispatchMessage(d);break;case"c":var d=JSON.parse(a.slice(1)||"[]");b._didClose(d[0],d[1]);break;case"h":b._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(b){var d=this;d.protocol&&(d._debug("Closed transport:",d.protocol,""+b),d.protocol=null),d._transport_tref&&(clearTimeout(d._transport_tref),d._transport_tref=null);for(;;){var e=d.protocol=d._protocols.shift();if(!e)return!1;if(y[e]&&y[e].need_body===!0&&(!a.body||typeof a.readyState!="undefined"&&a.readyState!=="complete"))return d._protocols.unshift(e),d.protocol="waiting-for-load",c.attachEvent("load",function(){d._try_next_protocol()}),!0;if(!!y[e]&&!!y[e].enabled(d._options)){var f=y[e].roundTrips||1,g=(d._options.rto||0)*f||5e3;d._transport_tref=c.delay(g,function(){d.readyState===y.CONNECTING&&d._didClose(2007,"Transport timeouted")});var h=c.random_string(8),i=d._base_url+"/"+d._server+"/"+h;return d._debug("Opening transport:",e," url:"+i," RTO:"+d._options.rto),d._transport=new y[e](d,i,d._base_url),!0}d._debug("Skipping transport:",e)}},y.prototype.close=function(a,b){var d=this;if(a&&!c.userSetCode(a))throw new Error("INVALID_ACCESS_ERR");return d.readyState!==y.CONNECTING&&d.readyState!==y.OPEN?!1:(d.readyState=y.CLOSING,d._didClose(a||1e3,b||"Normal closure"),!0)},y.prototype.send=function(a){var b=this;if(b.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return b.readyState===y.OPEN&&b._transport.doSend(c.quote(""+a)),!0},y.prototype._applyInfo=function(b,d,e){var f=this;f._options.info=b,f._options.rtt=d,f._options.rto=c.countRTO(d),f._options.info.null_origin=!a.domain;var g=c.probeProtocols();f._protocols=c.detectProtocols(g,e,b)};var z=y.websocket=function(a,d){var e=this,f=d+"/websocket";f.slice(0,5)==="https"?f="wss"+f.slice(5):f="ws"+f.slice(4),e.ri=a,e.url=f;var g=b.WebSocket||b.MozWebSocket;e.ws=new g(e.url),e.ws.onmessage=function(a){e.ri._didMessage(a.data)},e.unload_ref=c.unload_add(function(){e.ws.close()}),e.ws.onclose=function(){e.ri._didMessage(c.closeFrame(1006,"WebSocket connection broken"))}};z.prototype.doSend=function(a){this.ws.send("["+a+"]")},z.prototype.doCleanup=function(){var a=this,b=a.ws;b&&(b.onmessage=b.onclose=null,b.close(),c.unload_del(a.unload_ref),a.unload_ref=a.ri=a.ws=null)},z.enabled=function(){return!!b.WebSocket||!!b.MozWebSocket},z.roundTrips=2;var A=function(){};A.prototype.send_constructor=function(a){var b=this;b.send_buffer=[],b.sender=a},A.prototype.doSend=function(a){var b=this;b.send_buffer.push(a),b.send_stop||b.send_schedule()},A.prototype.send_schedule_wait=function(){var a=this,b;a.send_stop=function(){a.send_stop=null,clearTimeout(b)},b=c.delay(25,function(){a.send_stop=null,a.send_schedule()})},A.prototype.send_schedule=function(){var a=this;if(a.send_buffer.length>0){var b="["+a.send_buffer.join(",")+"]";a.send_stop=a.sender(a.trans_url,b,function(b,c){a.send_stop=null,b===!1?a.ri._didClose(1006,"Sending error "+c):a.send_schedule_wait()}),a.send_buffer=[]}},A.prototype.send_destructor=function(){var a=this;a._send_stop&&a._send_stop(),a._send_stop=null};var B=function(b,d,e){var f=this;if(!("_send_form"in f)){var g=f._send_form=a.createElement("form"),h=f._send_area=a.createElement("textarea");h.name="d",g.style.display="none",g.style.position="absolute",g.method="POST",g.enctype="application/x-www-form-urlencoded",g.acceptCharset="UTF-8",g.appendChild(h),a.body.appendChild(g)}var g=f._send_form,h=f._send_area,i="a"+c.random_string(8);g.target=i,g.action=b+"/jsonp_send?i="+i;var j;try{j=a.createElement('<iframe name="'+i+'">')}catch(k){j=a.createElement("iframe"),j.name=i}j.id=i,g.appendChild(j),j.style.display="none";try{h.value=d}catch(l){c.log("Your browser is seriously broken. Go home! "+l.message)}g.submit();var m=function(a){if(!j.onerror)return;j.onreadystatechange=j.onerror=j.onload=null,c.delay(500,function(){j.parentNode.removeChild(j),j=null}),h.value="",e(!0)};return j.onerror=j.onload=m,j.onreadystatechange=function(a){j.readyState=="complete"&&m()},m},C=function(a){return function(b,c,d){var e=new a("POST",b+"/xhr_send",c);return e.onfinish=function(a,b){d(a===200||a===204,"http status "+a)},function(a){d(!1,a)}}},D=function(b,d){var e,f=a.createElement("script"),g,h=function(a){g&&(g.parentNode.removeChild(g),g=null),f&&(clearTimeout(e),f.parentNode.removeChild(f),f.onreadystatechange=f.onerror=f.onload=f.onclick=null,f=null,d(a),d=null)},i=!1,j=null;f.id="a"+c.random_string(8),f.src=b,f.type="text/javascript",f.charset="UTF-8",f.onerror=function(a){j||(j=setTimeout(function(){i||h(c.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},f.onload=function(a){h(c.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},f.onreadystatechange=function(a){if(/loaded|closed/.test(f.readyState)){if(f&&f.htmlFor&&f.onclick){i=!0;try{f.onclick()}catch(b){}}f&&h(c.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if(typeof f.async=="undefined"&&a.attachEvent)if(!/opera/i.test(navigator.userAgent)){try{f.htmlFor=f.id,f.event="onclick"}catch(k){}f.async=!0}else g=a.createElement("script"),g.text="try{var a = document.getElementById('"+f.id+"'); if(a)a.onerror();}catch(x){};",f.async=g.async=!1;typeof f.async!="undefined"&&(f.async=!0),e=setTimeout(function(){h(c.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=a.getElementsByTagName("head")[0];return l.insertBefore(f,l.firstChild),g&&l.insertBefore(g,l.firstChild),h},E=y["jsonp-polling"]=function(a,b){c.polluteGlobalNamespace();var d=this;d.ri=a,d.trans_url=b,d.send_constructor(B),d._schedule_recv()};E.prototype=new A,E.prototype._schedule_recv=function(){var a=this,b=function(b){a._recv_stop=null,b&&(a._is_closing||a.ri._didMessage(b)),a._is_closing||a._schedule_recv()};a._recv_stop=F(a.trans_url+"/jsonp",D,b)},E.enabled=function(){return!0},E.need_body=!0,E.prototype.doCleanup=function(){var a=this;a._is_closing=!0,a._recv_stop&&a._recv_stop(),a.ri=a._recv_stop=null,a.send_destructor()};var F=function(a,d,e){var f="a"+c.random_string(6),g=a+"?c="+escape(h+"."+f),i=0,j=function(a){switch(i){case 0:delete b[h][f],e(a);break;case 1:e(a),i=2;break;case 2:delete b[h][f]}},k=d(g,j);b[h][f]=k;var l=function(){b[h][f]&&(i=1,b[h][f](c.closeFrame(1e3,"JSONP user aborted read")))};return l},G=function(){};G.prototype=new A,G.prototype.run=function(a,b,c,d,e){var f=this;f.ri=a,f.trans_url=b,f.send_constructor(C(e)),f.poll=new $(a,d,b+c,e)},G.prototype.doCleanup=function(){var a=this;a.poll&&(a.poll.abort(),a.poll=null)};var H=y["xhr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",bd,c.XHRCorsObject)};H.prototype=new G,H.enabled=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},H.roundTrips=2,H.need_body=!0;var I=y["xdr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",bd,c.XDRObject)};I.prototype=new G,I.enabled=function(){return!!b.XDomainRequest},I.roundTrips=2;var J=y["xhr-polling"]=function(a,b){this.run(a,b,"/xhr",bd,c.XHRCorsObject)};J.prototype=new G,J.enabled=H.enabled,J.roundTrips=2;var K=y["xdr-polling"]=function(a,b){this.run(a,b,"/xhr",bd,c.XDRObject)};K.prototype=new G,K.enabled=I.enabled,K.roundTrips=2;var L=function(){};L.prototype.i_constructor=function(a,b,d){var e=this;e.ri=a,e.origin=c.getOrigin(d),e.base_url=d,e.trans_url=b;var f=d+"/iframe.html";e.ri._options.devel&&(f+="?t="+ +(new Date)),e.window_id=c.random_string(8),f+="#"+e.window_id,e.iframeObj=c.createIframe(f,function(a){e.ri._didClose(1006,"Unable to load an iframe ("+a+")")}),e.onmessage_cb=c.bind(e.onmessage,e),c.attachMessage(e.onmessage_cb)},L.prototype.doCleanup=function(){var a=this;if(a.iframeObj){c.detachMessage(a.onmessage_cb);try{a.iframeObj.iframe.contentWindow&&a.postMessage("c")}catch(b){}a.iframeObj.cleanup(),a.iframeObj=null,a.onmessage_cb=a.iframeObj=null}},L.prototype.onmessage=function(a){var b=this;if(a.origin!==b.origin)return;var c=a.data.slice(0,8),d=a.data.slice(8,9),e=a.data.slice(9);if(c!==b.window_id)return;switch(d){case"s":b.iframeObj.loaded(),b.postMessage("s",JSON.stringify([y.version,b.protocol,b.trans_url,b.base_url]));break;case"t":b.ri._didMessage(e)}},L.prototype.postMessage=function(a,b){var c=this;c.iframeObj.post(c.window_id+a+(b||""),c.origin)},L.prototype.doSend=function(a){this.postMessage("m",a)},L.enabled=function(){var a=navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Konqueror")!==-1;return(typeof b.postMessage=="function"||typeof b.postMessage=="object")&&!a};var M,N=function(a,d){parent!==b?parent.postMessage(M+a+(d||""),"*"):c.log("Can't postMessage, no parent window.",a,d)},O=function(){};O.prototype._didClose=function(a,b){N("t",c.closeFrame(a,b))},O.prototype._didMessage=function(a){N("t",a)},O.prototype._doSend=function(a){this._transport.doSend(a)},O.prototype._doCleanup=function(){this._transport.doCleanup()},c.parent_origin=undefined,y.bootstrap_iframe=function(){var d;M=a.location.hash.slice(1);var e=function(a){if(a.source!==parent)return;typeof c.parent_origin=="undefined"&&(c.parent_origin=a.origin);if(a.origin!==c.parent_origin)return;var e=a.data.slice(0,8),f=a.data.slice(8,9),g=a.data.slice(9);if(e!==M)return;switch(f){case"s":var h=JSON.parse(g),i=h[0],j=h[1],k=h[2],l=h[3];i!==y.version&&c.log('Incompatibile SockJS! Main site uses: "'+i+'", the iframe:'+' "'+y.version+'".');if(!c.flatUrl(k)||!c.flatUrl(l)){c.log("Only basic urls are supported in SockJS");return}if(!c.isSameOriginUrl(k)||!c.isSameOriginUrl(l)){c.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([b.location.href,k,l])+")");return}d=new O,d._transport=new O[j](d,k,l);break;case"m":d._doSend(g);break;case"c":d&&d._doCleanup(),d=null}};c.attachMessage(e),N("s")};var P=function(a,b){var d=this;c.delay(function(){d.doXhr(a,b)})};P.prototype=new f(["finish"]),P.prototype.doXhr=function(a,b){var d=this,e=(new Date).getTime(),f=new b("GET",a+"/info"),g=c.delay(8e3,function(){f.ontimeout()});f.onfinish=function(a,b){clearTimeout(g),g=null;if(a===200){var c=(new Date).getTime()-e,f=JSON.parse(b);typeof f!="object"&&(f={}),d.emit("finish",f,c)}else d.emit("finish")},f.ontimeout=function(){f.close(),d.emit("finish")}};var Q=function(b){var d=this,e=function(){var a=new L;a.protocol="w-iframe-info-receiver";var c=function(b){if(typeof b=="string"&&b.substr(0,1)==="m"){var c=JSON.parse(b.substr(1)),e=c[0],f=c[1];d.emit("finish",e,f)}else d.emit("finish");a.doCleanup(),a=null},e={_options:{},_didClose:c,_didMessage:c};a.i_constructor(e,b,b)};a.body?e():c.attachEvent("load",e)};Q.prototype=new f(["finish"]);var R=function(){var a=this;c.delay(function(){a.emit("finish",{},2e3)})};R.prototype=new f(["finish"]);var S=function(a){if(c.isSameOriginUrl(a))return new P(a,c.XHRLocalObject);switch(c.isXHRCorsCapable()){case 1:return new P(a,c.XHRLocalObject);case 2:return new P(a,c.XDRObject);case 3:return new Q(a);default:return new R}},T=O["w-iframe-info-receiver"]=function(a,b,d){var e=new P(d,c.XHRLocalObject);e.onfinish=function(b,c){a._didMessage("m"+JSON.stringify([b,c])),a._didClose()}};T.prototype.doCleanup=function(){};var U=y["iframe-eventsource"]=function(){var a=this;a.protocol="w-iframe-eventsource",a.i_constructor.apply(a,arguments)};U.prototype=new L,U.enabled=function(){return"EventSource"in b&&L.enabled()},U.need_body=!0,U.roundTrips=3;var V=O["w-iframe-eventsource"]=function(a,b){this.run(a,b,"/eventsource",_,c.XHRLocalObject)};V.prototype=new G;var W=y["iframe-xhr-polling"]=function(){var a=this;a.protocol="w-iframe-xhr-polling",a.i_constructor.apply(a,arguments)};W.prototype=new L,W.enabled=function(){return b.XMLHttpRequest&&L.enabled()},W.need_body=!0,W.roundTrips=3;var X=O["w-iframe-xhr-polling"]=function(a,b){this.run(a,b,"/xhr",bd,c.XHRLocalObject)};X.prototype=new G;var Y=y["iframe-htmlfile"]=function(){var a=this;a.protocol="w-iframe-htmlfile",a.i_constructor.apply(a,arguments)};Y.prototype=new L,Y.enabled=function(){return L.enabled()},Y.need_body=!0,Y.roundTrips=3;var Z=O["w-iframe-htmlfile"]=function(a,b){this.run(a,b,"/htmlfile",bc,c.XHRLocalObject)};Z.prototype=new G;var $=function(a,b,c,d){var e=this;e.ri=a,e.Receiver=b,e.recv_url=c,e.AjaxObject=d,e._scheduleRecv()};$.prototype._scheduleRecv=function(){var a=this,b=a.poll=new a.Receiver(a.recv_url,a.AjaxObject),c=0;b.onmessage=function(b){c+=1,a.ri._didMessage(b.data)},b.onclose=function(c){a.poll=b=b.onmessage=b.onclose=null,a.poll_is_closing||(c.reason==="permanent"?a.ri._didClose(1006,"Polling error ("+c.reason+")"):a._scheduleRecv())}},$.prototype.abort=function(){var a=this;a.poll_is_closing=!0,a.poll&&a.poll.abort()};var _=function(a){var b=this,d=new EventSource(a);d.onmessage=function(a){b.dispatchEvent(new e("message",{data:unescape(a.data)}))},b.es_close=d.onerror=function(a,f){var g=f?"user":d.readyState!==2?"network":"permanent";b.es_close=d.onmessage=d.onerror=null,d.close(),d=null,c.delay(200,function(){b.dispatchEvent(new e("close",{reason:g}))})}};_.prototype=new d,_.prototype.abort=function(){var a=this;a.es_close&&a.es_close({},!0)};var ba,bb=function(){if(ba===undefined)if("ActiveXObject"in b)try{ba=!!(new ActiveXObject("htmlfile"))}catch(a){}else ba=!1;return ba},bc=function(a){var d=this;c.polluteGlobalNamespace(),d.id="a"+c.random_string(6,26),a+=(a.indexOf("?")===-1?"?":"&")+"c="+escape(h+"."+d.id);var f=bb()?c.createHtmlfile:c.createIframe,g;b[h][d.id]={start:function(){g.loaded()},message:function(a){d.dispatchEvent(new e("message",{data:a}))},stop:function(){d.iframe_close({},"network")}},d.iframe_close=function(a,c){g.cleanup(),d.iframe_close=g=null,delete b[h][d.id],d.dispatchEvent(new e("close",{reason:c}))},g=f(a,function(a){d.iframe_close({},"permanent")})};bc.prototype=new d,bc.prototype.abort=function(){var a=this;a.iframe_close&&a.iframe_close({},"user")};var bd=function(a,b){var c=this,d=0;c.xo=new b("POST",a,null),c.xo.onchunk=function(a,b){if(a!==200)return;for(;;){var f=b.slice(d),g=f.indexOf("\n");if(g===-1)break;d+=g+1;var h=f.slice(0,g);c.dispatchEvent(new e("message",{data:h}))}},c.xo.onfinish=function(a,b){c.xo.onchunk(a,b),c.xo=null;var d=a===200?"network":"permanent";c.dispatchEvent(new e("close",{reason:d}))}};return bd.prototype=new d,bd.prototype.abort=function(){var a=this;a.xo&&(a.xo.close(),a.dispatchEvent(new e("close",{reason:"user"})),a.xo=null)},y.getUtils=function(){return c},y.getIframeTransport=function(){return L},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),typeof define=="function"&&define.amd&&define("sockjs",[],function(){return SockJS})

//^^^ Sockets - Digger


require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty;function isPlainObject(obj){if(!obj||toString.call(obj)!=="[object Object]"||obj.nodeType||obj.setInterval)return false;var has_own_constructor=hasOwnProperty.call(obj,"constructor");var has_is_property_of_method=hasOwnProperty.call(obj.constructor.prototype,"isPrototypeOf");if(obj.constructor&&!has_own_constructor&&!has_is_property_of_method)return false;var key;for(key in obj){}return key===undefined||hasOwn.call(obj,key)}module.exports=function extend(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&typeof target!=="function"){target={}}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[]}else{clone=src&&isPlainObject(src)?src:{}}target[name]=extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target}},{}],2:[function(require,module,exports){var hat=module.exports=function(bits,base){if(!base)base=16;if(bits===undefined)bits=128;if(bits<=0)return"0";var digits=Math.log(Math.pow(2,bits))/Math.log(base);for(var i=2;digits===Infinity;i*=2){digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i}var rem=digits-Math.floor(digits);var res="";for(var i=0;i<Math.floor(digits);i++){var x=Math.floor(Math.random()*base).toString(base);res=x+res}if(rem){var b=Math.pow(base,rem);var x=Math.floor(Math.random()*b).toString(base);res=x+res}var parsed=parseInt(res,base);if(parsed!==Infinity&&parsed>=Math.pow(2,bits)){return hat(bits,base)}else return res};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters++>10){if(expandBy)bits+=expandBy;else throw new Error("too many ID collisions, use more bits")}var id=hat(bits,base)}while(Object.hasOwnProperty.call(hats,id));hats[id]=data;return id};var hats=fn.hats={};fn.get=function(id){return fn.hats[id]};fn.set=function(id,value){fn.hats[id]=value;return fn};fn.bits=bits||128;fn.base=base||16;return fn}},{}],3:[function(require,module,exports){var extend=require("extend");var hat=require("hat");var utils=module.exports={};utils.diggerid=function(){return hat()};utils.littleid=function(chars){chars=chars||6;var pattern="";for(var i=0;i<chars;i++){pattern+="x"}return pattern.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};utils.escapeRegexp=function(search){return search.replace(/([\!\$\(\)\*\+\.\/\:\=\?\[\\\]\^\{\|\}])/g,"\\$1")};utils.json_request=function(req){return{method:req.method.toLowerCase(),url:req.url,body:req.body,headers:req.headers}};utils.isArray=function(arr){return Object.prototype.toString.call(arr)=="[object Array]"};utils.toArray=function(args){return Array.prototype.slice.call(args,0)};utils.extend=extend},{extend:1,hat:2}],4:[function(require,module,exports){var exists=module.exports.exists=function exists(object,path){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return false}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return false}if(path.length===0){return Object.hasOwnProperty.apply(object,[key])}else{return exists(object[key],path)}};var get=module.exports.get=function get(object,path){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return}if(path.length===0){return object[key]}if(path.length){return get(object[key],path)}};var search=module.exports.search=function search(object,path){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return}if(key==="*"){key=".*"}if(typeof key==="string"){key=new RegExp(key)}if(path.length===0){return Object.keys(object).filter(key.test.bind(key)).map(function(k){return object[k]})}else{return Array.prototype.concat.apply([],Object.keys(object).filter(key.test.bind(key)).map(function(k){return search(object[k],path)}))}};var put=module.exports.put=function put(object,path,value){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return false}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return false}if(path.length===0){object[key]=value}else{if(typeof object[key]==="undefined"){object[key]={}}if(typeof object[key]!=="object"||object[key]===null){return false}return put(object[key],path,value)}};var remove=module.exports.remove=function remove(object,path,value){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return false}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return false}if(path.length===0){if(!Object.hasOwnProperty.call(object,key)){return false}delete object[key];return true}else{return remove(object[key],path,value)}};var deepKeys=module.exports.deepKeys=function deepKeys(object,prefix){if(typeof prefix==="undefined"){prefix=[]}var keys=[];for(var k in object){if(!Object.hasOwnProperty.call(object,k)){continue}keys.push(prefix.concat([k]));if(typeof object[k]==="object"&&object[k]!==null){keys=keys.concat(deepKeys(object[k],prefix.concat([k])))}}return keys}},{}],5:[function(require,module,exports){var Proto=require("./proto");module.exports=function(tag,data){return Proto.factory(tag,data)};module.exports.proto=Proto;module.exports.augment_prototype=function(api){for(var prop in api){Proto.prototype[prop]=api[prop]}}},{"./proto":6}],6:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var dotty=require("dotty");var util=require("util");var utils=require("digger-utils");function Container(){}function factory(){var models=[];if(typeof arguments[0]==="string"){var string=arguments[0];var c=string.charAt(0);if(c==="{"||c==="["){var data=JSON.parse(string);if(c==="{"){data=[data]}models=data}else{var model=arguments[1]||{};var digger=model._digger||{};digger.tag=string;model._digger=digger;models=[model]}}else if(Object.prototype.toString.call(arguments[0])=="[object Array]"){models=arguments[0]}else if(typeof arguments[0]==="object"){models=[arguments[0]]}if(models[0]===undefined||models[0]===null){models=[]}var instance=function container(){if(!instance.select){throw new Error("there is no select method attached to this container")}var args=[arguments[0]];if(arguments.length>1){args.push(arguments[1])}return instance.select.apply(instance,args)};function process_model(model){}instance.__proto__=Container.prototype;instance.build(models);return instance}Container.factory=factory;util.inherits(Container,EventEmitter);module.exports=Container;Container.prototype.build=function(models){this.models=models||[];function process_model(model,warehouse){if(!model._digger){model._digger={}}if(!model._data){model._data={}}if(!model._digger.diggerid){model._digger.diggerid=utils.diggerid()}if(!model._digger.diggerwarehouse&&warehouse){model._digger.diggerwarehouse=warehouse}if(model._children){var parentwarehouse=model._digger.diggerwarehouse;model._children.forEach(function(model){process_model(model,parentwarehouse)})}}this.models.forEach(function(model){process_model(model)});return this};Container.prototype.toJSON=function(){return this.models};Container.prototype.spawn=function(models){models=models||[];var container=Container.factory(models);if(this.supplychain){container.supplychain=this.supplychain}return container};Container.prototype.clone=function(){var data=JSON.parse(JSON.stringify(this.models));var ret=this.spawn(data);ret.recurse(function(des){var model=des.get(0);var digger=model._digger||{};digger.diggerid=utils.diggerid();model._digger=digger});ret.ensure_parent_ids();return ret};Container.prototype.ensure_parent_ids=function(parent){var self=this;if(parent){this.each(function(c){c.diggerparentid(parent.diggerid())})}this.children().each(function(child){child.ensure_parent_ids(self)})};Container.prototype.inject_paths=function(basepath){this.diggerpath(basepath);this.children().each(function(child,index){child.inject_paths(basepath.concat([index]))})};Container.prototype.ensure_meta=function(done){if(!this.diggerid()){this.diggerid(utils.diggerid())}var topcounter=0;if(this.diggerpath().length<=0){this.inject_paths([topcounter]);topcounter++}this.ensure_parent_ids();return this};Container.prototype.children=function(){var models=[];var self=this;this.each(function(container){models=models.concat(container.get(0)._children||[])});return this.spawn(models)};Container.prototype.recurse=function(fn){this.descendents().each(fn);return this};Container.prototype.descendents=function(){var ret=[];function scoopmodels(container){ret=ret.concat(container.models);container.children().each(scoopmodels)}scoopmodels(this);return this.spawn(ret)};Container.prototype.containers=function(){var self=this;return this.models.map(function(model){var ret=self.spawn([model]);ret["$$hashKey"]=model._digger.diggerid;return ret})};Container.prototype.skeleton=function(){return this.models.map(function(model){return model._digger||{}})};Container.prototype.add=function(container){var self=this;if(!container){return this}if(Object.prototype.toString.call(container)=="[object Array]"){container.forEach(function(c){self.add(c)})}else{this.models=this.models.concat(container.models)}return this};Container.prototype.each=function(fn){this.containers().forEach(fn);return this};Container.prototype.map=function(fn){return this.containers().map(fn)};Container.prototype.count=function(){return this.models.length};Container.prototype.first=function(){return this.eq(0)};Container.prototype.last=function(){return this.eq(this.count()-1)};Container.prototype.eq=function(index){return this.spawn(this.get(index))};Container.prototype.get=function(index){return this.models[index]};function valuereader(model,name){if(!name){return model}return dotty.get(model,name)}function valuesetter(model,value,name){if(!name){return value}dotty.put(model,name,value);return value}function makepath(path,base){var parts=[path];if(base){parts.unshift(base)}return parts.join(".")}function wrapper(basepath){return function(path,val){var self=this;if(arguments.length<=0){if(self.isEmpty()){return null}return valuereader(self.get(0),basepath)}else if(arguments.length===1&&typeof path==="string"){if(self.isEmpty()){return null}return valuereader(self.get(0),makepath(path,basepath))}else if(arguments.length===1){self.models.forEach(function(model){valuesetter(model,val,basepath)});return self}else if(arguments.length>1){var usepath=makepath(path,basepath);self.models.forEach(function(model){valuesetter(model,val,usepath)});return self}}}function property_wrapper(basepath,property){return function(val){var self=this;if(arguments.length<=0){if(self.isEmpty()){return null}var model=dotty.get(self.get(0),basepath);return model[property]}else{if(!self.isEmpty()){self.models.forEach(function(model){var basemodel=dotty.get(model,basepath);basemodel[property]=val})}return self}}}function remove_wrapper(basepath){return function(path){var self=this;var usepath=makepath(path,basepath);self.models.forEach(function(model){dotty.remove(model,usepath)});return self}}Container.prototype.attr=wrapper();Container.prototype.digger=wrapper("_digger");Container.prototype.data=wrapper("_data");Container.prototype.symlink=function(target,selector){var links=this.digger("symlinks")||{};var hasselector=arguments.length>1;if(typeof target==="string"){links["symlink:"+target+(selector?"/"+selector:"")]={type:"symlink",warehouse:target,selector:selector}}else{target.each(function(t){links["symlink:"+t.diggerwarehouse()+"/"+t.diggerid()+(selector?"/"+selector:"")]={type:"symlink",warehouse:t.diggerwarehouse(),diggerid:t.diggerid(),selector:selector}})}this.digger("symlinks",links);return this};function attrlink(listmode){return function(field,target,selector){var links=this.digger("symlinks")||{};var hasselector=arguments.length>1;if(typeof target==="string"){links["attr:"+target+(selector?"/"+selector:"")+":"+field]={type:"attr",field:field,listmode:listmode,warehouse:target,selector:selector}}else{target.each(function(t){links["attr:"+t.diggerwarehouse()+"/"+t.diggerid()+(selector?"/"+selector:"")+":"+field]={type:"attr",field:field,listmode:listmode,warehouse:t.diggerwarehouse(),diggerid:t.diggerid(),selector:selector}})}this.digger("symlinks",links);return this}}Container.prototype.attrlink=attrlink();Container.prototype.attrlistlink=attrlink(true);Container.prototype.diggerid=property_wrapper("_digger","diggerid");Container.prototype.diggerparentid=property_wrapper("_digger","diggerparentid");Container.prototype.diggerwarehouse=property_wrapper("_digger","diggerwarehouse");var pathwrapper=property_wrapper("_digger","diggerpath");Container.prototype.diggerpath=function(){var ret=pathwrapper.apply(this,utils.toArray(arguments));if(!utils.isArray(ret)){ret=[]}return ret};var headerwrapper=property_wrapper("_digger","diggerbranch");Container.prototype.diggerbranch=function(){var ret=branchwrapper.apply(this,utils.toArray(arguments));if(!utils.isArray(ret)){ret=[]}return ret};Container.prototype.addBranch=function(where){var self=this;var branches=this.diggerbranch();where.each(function(container){branches.push(container.diggerurl())});this.diggerbranch(branches);return this};Container.prototype.removeBranch=function(where){var self=this;var branches=this.diggerbranch();where.each(function(container){var newbranches=[];for(var i=0;i<branches.length;i++){if(branches[i]!=container.diggerurl()){newbranches.push(branches[i])}}branches=newbranches});this.diggerbranch(branches);return this};Container.prototype.id=property_wrapper("_digger","id");Container.prototype.tag=property_wrapper("_digger","tag");Container.prototype.classnames=property_wrapper("_digger","class");Container.prototype.removeAttr=remove_wrapper();Container.prototype.removeDigger=remove_wrapper("_digger");Container.prototype.removeData=remove_wrapper("_digger.data");Container.prototype.is=function(tag){return this.tag()==tag};Container.prototype.addClass=function(classname){var self=this;this.models.forEach(function(model){var classnames=model._digger.class||[];var found=false;classnames.forEach(function(c){if(c==classname){found=true}});if(!found){classnames.push(classname)}model._digger.class=classnames});return this};Container.prototype.removeClass=function(classname){var self=this;this.models.forEach(function(model){var classnames=model._digger.class||[];var newclassnames=[];classnames.forEach(function(c){if(c!=classname){newclassnames.push(c)}});model._digger.class=newclassnames});return this};Container.prototype.hasClass=function(classname){var found=false;(this.classnames()||[]).forEach(function(c){if(c==classname){found=true}});return found};Container.prototype.hasAttr=function(name){var prop=this.attr(name);return prop!==null};Container.prototype.isEmpty=function(){return this.count()===0};Container.prototype.inject_data=function(data){this.models.forEach(function(model){utils.extend(model,data)});return this};Container.prototype.diggerurl=function(){var warehouse=this.diggerwarehouse();var id=this.diggerid();var url=warehouse||"/";if(id&&this.tag()!="_supplychain"){if(warehouse!="/"){url+="/"}url+=id}return url.replace(/\/\//g,"/")};Container.prototype.title=function(){var name=this.attr("name");if(!name){name=this.attr("title")}if(!name){name=this.tag()}return name};Container.prototype.summary=function(options){options=options||{};var parts=[];var title=this.attr("name")||this.attr("title")||"";if(title.length>0&&options.title!==false){parts.push(title+": ")}parts.push(this.tag());var id=this.id()||"";if(id.length>0){parts.push("#"+id)}var classnames=this.classnames()||[];if(classnames.length>0){classnames.forEach(function(classname){if(classname.match(/\w/)){parts.push("."+classname.replace(/^\s+/,"").replace(/\s+$/,""))}})}parts.push("="+this.diggerid().substr(0,6)+"...");return parts.join("")};Container.prototype.toString=function(){return this.summary()};Container.prototype.combine_tree=function(){this.models=utils.combine_tree_results(this.models);return this}},{"digger-utils":3,dotty:4,events:37,util:38}],7:[function(require,module,exports){module.exports=parse;module.exports.mini=miniparse;var chunkers=[{name:"tag",regexp:/^(\*|\w+)/,mapper:function(val,map){map.tag=val}},{name:"class",regexp:/^\.\w+/,mapper:function(val,map){map.class=map.class||{};map.class[val.replace(/^\./,"")]=true}},{name:"id",regexp:/^#\w+/,mapper:function(val,map){map.id=val.replace(/^#/,"")}},{name:"diggerid",regexp:/^=[\w-]+/,mapper:function(val,map){map.diggerid=val.replace(/^=/,"")}},{name:"modifier",regexp:/^:\w+(\(.*?\))?/,mapper:function(val,map){map.modifier=map.modifier||{};var parts=val.split("(");var key=parts[0];val=parts[1];if(val){val=val.replace(/\)$/,"");if(val.match(/^[\d\.-]+$/)){val=JSON.parse(val)}}else{val=true}map.modifier[key.replace(/^:/,"")]=val}},{name:"attr",regexp:/^\[.*?["']?.*?["']?\]/,mapper:function(val,map){map.attr=map.attr||[];var match=val.match(/\[(.*?)([=><\^\|\*\~\$\!]+)["']?(.*?)["']?\]/);if(match){map.attr.push({field:match[1],operator:match[2],value:match[3]})}else{map.attr.push({field:val.replace(/^\[/,"").replace(/\]$/,"")})}}},{name:"splitter",regexp:/^[ ,<>]+/,mapper:function(val,map){map.splitter=val.replace(/\s+/g,"")}}];function parseChunks(selector){var lastMatch=null;var workingString=selector?selector:"";var lastString="";var chunks=[];var matchNextChunk=function(){lastMatch=null;for(var i in chunkers){var chunker=chunkers[i];if(lastMatch=workingString.match(chunker.regexp)){var data={value:lastMatch[0]};for(prop in chunker){data[prop]=chunker[prop]}data.string=lastMatch[0];chunks.push(data);workingString=workingString.replace(lastMatch[0],"");return true}}return false};while(matchNextChunk()){if(lastString==workingString){break}}return chunks}function new_selector(){return{string:"","class":{},attr:[],modifier:{}}}function parse(selector_string){if(typeof selector_string!="string"){return selector_string}var chunks=parseChunks(selector_string);var phases=[];var currentPhase=[];var currentSelector=new_selector();var addCurrentPhase=function(){if(currentPhase.length>0){phases.push(currentPhase)}currentPhase=[]};var addCurrentSelector=function(){if(Object.keys(currentSelector).length>0){currentPhase.push(currentSelector)}currentSelector=new_selector()};var addChunkToSelector=function(chunk,selector){chunk.mapper.apply(null,[chunk.value,selector]);selector.string+=chunk.string};chunks.forEach(function(chunk,index){if(chunk.name=="splitter"&&chunk.value.match(/,/)){addCurrentSelector();addCurrentPhase()}else{if(chunk.name=="splitter"&&index>0){addCurrentSelector()}addChunkToSelector(chunk,currentSelector)}});addCurrentSelector();addCurrentPhase();return{string:selector_string,phases:phases}}function miniparse(selector_string){if(typeof selector_string!=="string"){return selector_string}selector_string=selector_string||"";var selector={"class":{},modifier:{}};selector_string=selector_string.replace(/_(\w+)/,function(match,id){selector.id=id;return""});selector_string=selector_string.replace(/\.(\w+)/g,function(match,classname){selector.class[classname]=true;return""});if(selector_string.match(/\d/)){selector.diggerid=selector_string}else{selector.tag=selector_string}return selector}},{}],8:[function(require,module,exports){module.exports=require(1)},{}],9:[function(require,module,exports){module.exports=require(2)},{}],10:[function(require,module,exports){var extend=require("extend");var hat=require("hat");var utils=module.exports={};utils.diggerid=function(){return hat()};utils.littleid=function(chars){chars=chars||6;var pattern="";for(var i=0;i<chars;i++){pattern+="x"}return pattern.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};utils.escapeRegexp=function(search){return search.replace(/([\!\$\(\)\*\+\.\/\:\=\?\[\\\]\^\{\|\}])/g,"\\$1")};utils.json_request=function(req){return{method:req.method.toLowerCase(),url:req.url,body:req.body,headers:req.headers}};utils.isArray=function(arr){return Object.prototype.toString.call(arr)=="[object Array]"};utils.toArray=function(args){return Array.prototype.slice.call(args,0)};utils.parse_request=function(method,url){};utils.export_user=function(user){var ret={};for(var prop in user){if(prop.charAt(0)!="_"){ret[prop]=user[prop]}}return ret};utils.extend=extend},{extend:8,hat:9}],11:[function(require,module,exports){var Selector=require("digger-selector");var utils=require("digger-utils");module.exports={request:request,select:select,append:append,save:save,remove:remove};function multiple_branch(list,wrapper){if(list.length<=1){return list[0]}else{wrapper.body=list;return wrapper}}function request(req){var self=this;if(this.count()<=0){throw new Error("there is nothing to delete")}var requests=[];this.each(function(container){var parts=[container.diggerwarehouse()];if(container.tag()!="_supplychain"){parts.push(container.diggerid())}parts.push(req.url.replace(/\//,""));var clone=JSON.parse(JSON.stringify(req));clone.url=parts.join("/");requests.push(clone)});var raw;if(requests.length>1){raw={method:"post",url:"/reception",headers:{"Content-Type":"application/json","x-contract-type":"merge","x-contract-id":utils.diggerid()},body:requests}}else{raw=requests[0]}return this.supplychain?this.supplychain.contract(raw,self):raw}function select(selector_string,context_string){var self=this;if(this.count()<=0){throw new Error("attempting a select on an empty container")}var strings=[selector_string];if(arguments.length>1){strings.push(context_string)}var selectors=strings.map(function(selector){return Selector(selector)});var context=this.containers();var groups={};this.each(function(container){var warehouse=container.diggerwarehouse()||"/";var arr=groups[warehouse]||[];arr.push(container);groups[warehouse]=arr});var warehouseurls=Object.keys(groups);var topcontract={};function basic_contract(type){return{method:"post",url:"/reception",headers:{"Content-Type":"application/json","x-contract-type":type,"x-contract-id":utils.diggerid()}}}function create_warehouse_pipe_contract(warehouseurl){var skeleton=groups[warehouseurl].map(function(c){return c.get(0)._digger}).filter(function(digger){return digger.tag!="_supplychain"});var phase_contracts=selectors.reverse().map(function(selector_phase){var selector_contracts=selector_phase.phases.map(function(selector_stages){var last_selector=selector_stages[selector_stages.length-1];var modifier=last_selector.modifier||{};modifier.laststep=true;last_selector.modifier=modifier;var selector_requests=selector_stages.map(function(selector){return{method:"post",url:(warehouseurl+"/select").replace(/\/\//g,"/"),headers:{"Content-Type":"application/json","x-json-selector":selector}}});selector_requests[0].body=skeleton;return multiple_branch(selector_requests,basic_contract("pipe"))});return multiple_branch(selector_contracts,basic_contract("merge"))});return multiple_branch(phase_contracts,basic_contract("pipe"))}var warehouse_pipe_contracts=warehouseurls.map(create_warehouse_pipe_contract);var topcontract=multiple_branch(warehouse_pipe_contracts,{method:"post",url:"/reception",headers:{"Content-Type":"application/json","x-contract-type":"merge","x-contract-id":utils.diggerid()}});return this.supplychain?this.supplychain.contract(topcontract,self).expect("containers"):topcontract}function append(appendcontainer){var self=this;if(arguments.length<=0||appendcontainer.count()<=0){throw new Error("there is nothing to append")}if(this.count()<=0){throw new Error("there is nothing to append to")}appendcontainer.recurse(function(a){a.removeAttr("_digger.diggerwarehouse");a.removeAttr("_digger.diggerpath")});var appendmodels=appendcontainer.models;var appendto=this.eq(0);var appendtomodel=this.get(0);appendtomodel._children=(appendtomodel._children||[]).concat(appendmodels);var raw={method:"post",headers:{"Content-Type":"application/json","x-contract-type":"merge","x-contract-id":utils.diggerid()},url:"/reception",body:[{method:"post",headers:{"Content-Type":"application/json","x-contract-id":utils.diggerid()},url:appendto.diggerurl(),body:appendmodels}]};appendcontainer.supplychain=this.supplychain;return this.supplychain?this.supplychain.contract(raw,self).after(function(results){var map={};appendmodels.forEach(function(model){map[model._digger.diggerid]=model});results.forEach(function(result){var model=map[result._digger.diggerid];if(model){for(var prop in result){model[prop]=result[prop]}}});return self.spawn(results)}):raw}function save(){var self=this;if(this.count()<=0){throw new Error("there is nothing to save")}var raw={method:"post",headers:{"Content-Type":"application/json","x-contract-type":"merge","x-contract-id":utils.diggerid()},url:"/reception",body:this.map(function(container){var model=container.get(0);var savemodel=JSON.parse(JSON.stringify(model));delete savemodel._children;delete savemodel._digger.data;var links=container.digger("symlinks")||{};for(var linkid in links){var link=links[linkid];if(link.type=="attr"){delete savemodel[link.field]}}return{method:"put",headers:{"Content-Type":"application/json","x-contract-id":utils.diggerid()},url:container.diggerurl(),body:savemodel}})};return this.supplychain?this.supplychain.contract(raw,self):raw}function remove(){var self=this;if(this.count()<=0){throw new Error("there is nothing to delete")}var raw={method:"post",url:"/reception",headers:{"Content-Type":"application/json","x-contract-type":"merge","x-contract-id":utils.diggerid()},body:this.map(function(container){return{method:"delete",headers:{"Content-Type":"application/json","x-contract-id":utils.diggerid()},url:container.diggerurl()}})};return this.supplychain?this.supplychain.contract(raw,self):raw}},{"digger-selector":7,"digger-utils":10}],12:[function(require,module,exports){module.exports=parse;module.exports.mini=miniparse;var chunkers=[{name:"tag",regexp:/^(\*|\w+)/,mapper:function(val,map){map.tag=val}},{name:"class",regexp:/^\.\w+/,mapper:function(val,map){map.class=map.class||{};map.class[val.replace(/^\./,"")]=true}},{name:"id",regexp:/^#\w+/,mapper:function(val,map){map.id=val.replace(/^#/,"")}},{name:"diggerid",regexp:/^=[\w-]+/,mapper:function(val,map){map.diggerid=val.replace(/^=/,"")}},{name:"modifier",regexp:/^:\w+(\(.*?\))?/,mapper:function(val,map){map.modifier=map.modifier||{};var parts=val.split("(");var key=parts[0];val=parts[1];if(val){val=val.replace(/\)$/,"");if(val.match(/^[\d\.-]+$/)){val=JSON.parse(val)}}else{val=true}map.modifier[key.replace(/^:/,"")]=val}},{name:"attr",regexp:/^\[.*?["']?.*?["']?\]/,mapper:function(val,map){map.attr=map.attr||[];var match=val.match(/\[(.*?)([=><\^\|\*\~\$\!]+)["']?(.*?)["']?\]/);if(match){map.attr.push({field:match[1],operator:match[2],value:match[3]})}else{map.attr.push({field:val.replace(/^\[/,"").replace(/\]$/,"")})}}},{name:"splitter",regexp:/^[ ,<>]+/,mapper:function(val,map){map.splitter=val.replace(/\s+/g,"")}}];function parseChunks(selector){var lastMatch=null;var workingString=selector?selector:"";var lastString="";var chunks=[];var matchNextChunk=function(){lastMatch=null;for(var i in chunkers){var chunker=chunkers[i];if(lastMatch=workingString.match(chunker.regexp)){var data={value:lastMatch[0]};for(prop in chunker){data[prop]=chunker[prop]}chunks.push(data);workingString=workingString.replace(lastMatch[0],"");return true}}return false};while(matchNextChunk()){if(lastString==workingString){break}}return chunks}function new_selector(){return{"class":{},attr:[],modifier:{}}}function parse(selector_string){if(typeof selector_string!="string"){return selector_string}var chunks=parseChunks(selector_string);var phases=[];var currentPhase=[];var currentSelector=new_selector();var addCurrentPhase=function(){if(currentPhase.length>0){phases.push(currentPhase)}currentPhase=[]};var addCurrentSelector=function(){if(Object.keys(currentSelector).length>0){currentPhase.push(currentSelector)}currentSelector=new_selector()};var addChunkToSelector=function(chunk,selector){chunk.mapper.apply(null,[chunk.value,selector])};chunks.forEach(function(chunk,index){if(chunk.name=="splitter"&&chunk.value.match(/,/)){addCurrentSelector();addCurrentPhase()}else{if(chunk.name=="splitter"&&index>0){addCurrentSelector()}addChunkToSelector(chunk,currentSelector)}});addCurrentSelector();addCurrentPhase();return{string:selector_string,phases:phases}}function miniparse(selector_string){if(typeof selector_string!=="string"){return selector_string}selector_string=selector_string||"";var selector={"class":{},modifier:{}};selector_string=selector_string.replace(/_(\w+)/,function(match,id){selector.id=id;return""});selector_string=selector_string.replace(/\.(\w+)/g,function(match,classname){selector.class[classname]=true;return""});if(selector_string.match(/\d/)){selector.diggerid=selector_string}else{selector.tag=selector_string}return selector}},{}],13:[function(require,module,exports){module.exports=require(1)},{}],14:[function(require,module,exports){module.exports=require(2)},{}],15:[function(require,module,exports){module.exports=require(3)},{extend:13,hat:14}],16:[function(require,module,exports){module.exports=factory;function State(arr){this.count=arr.length;this.index=0;this.finished=false}State.prototype.next=function(){this.index++;if(this.index>=this.count){this.finished=true}};function factory(searchfn){return function(selectors,context){var final_state=new State(selectors);var final_results=context.spawn();selectors.reverse().forEach(function(stage){final_state.next();var stage_results=context.spawn();stage.phases.forEach(function(phase){var phase_context=context;var selector_state=new State(phase);var cancel=false;phase.forEach(function(selector){if(cancel){return}selector_state.next();var results=searchfn(selector,phase_context);if(results.count()<=0){cancel=true;return false}if(!selector_state.finished){phase_context=results}else{stage_results.add(results)}return true})});if(stage_results.count()<=0){return false}if(!final_state.finished){context=stage_results}else{final_results=stage_results}});return final_results}}},{}],17:[function(require,module,exports){var find=require("./find");var search=require("./search");var Selector=require("digger-selector");var finder=find(search.searcher);var sortfns={title:function(a,b){if(a.title().toLowerCase()<b.title().toLowerCase())return-1;if(a.title().toLowerCase()>b.title().toLowerCase())return 1;return 0},field:function(name){return function(a,b){if(a.attr(name).toLowerCase()<b.attr(name).toLowerCase())return-1;if(a.attr(name).toLowerCase()>b.attr(name).toLowerCase())return 1;return 0}}};module.exports={find:function(selector,context){var selectors=[selector];if(context){selectors.push(context)}selectors=selectors.map(function(string){return Selector(string)});return finder(selectors,this)},sort:function(fn){if(typeof fn==="string"){fn=sortfns.field(fn)}else if(!fn){fn=sortfns.title}this.each(function(container){var newchildren=container.children().containers().sort(fn);var model=container.get(0);model.children=newchildren.map(function(container){return container.get(0)
})});return this},filter:function(filterfn){if(typeof filterfn!="function"){if(typeof filterfn=="string"){filterfn=Selector(filterfn).phases[0][0]}filterfn=search.compiler(filterfn)}var matching_container_array=this.containers().filter(filterfn);return this.spawn(matching_container_array.map(function(container){return container.get(0)}))},match:function(selector){if(this.count()<=0){return false}var results=this.filter(selector);return results.count()>0}}},{"./find":16,"./search":18,"digger-selector":12}],18:[function(require,module,exports){var utils=require("digger-utils");module.exports.searcher=search;module.exports.compiler=compile;var attr_compare_functions={"=":function(check,target){return check!=null&&check==target},"!=":function(check,target){return check!=null&&check!=target},">":function(check,target){target=parseFloat(target);return check!=null&&!isNaN(target)?check>target:false},">=":function(check,target){target=parseFloat(target);return check!=null&&!isNaN(target)?check>=target:false},"<":function(check,target){target=parseFloat(target);return check!=null&&!isNaN(target)?check<target:false},"<=":function(check,target){target=parseFloat(target);return check!=null&&!isNaN(target)?check<=target:false},"^=":function(check,target){return check!=null&&check.match(new RegExp("^"+utils.escapeRegexp(target),"i"))!==null},"$=":function(check,target){return check!=null&&check.match(new RegExp(utils.escapeRegexp(target)+"$","i"))!==null},"~=":function(check,target){return check!=null&&check.match(new RegExp("\\W"+utils.escapeRegexp(target)+"\\W","i"))!==null},"|=":function(check,target){return check!=null&&check.match(new RegExp("^"+utils.escapeRegexp(target)+"-","i"))!==null},"*=":function(check,target){return check!=null&&check.match(new RegExp(utils.escapeRegexp(target),"i"))!==null}};function compile(selector){return function(container){var model=container.get(0);var digger=model._digger;function notfilter(val){if(!val){val=false}return selector.modifier&&selector.modifier.not?!val:val}function notcountfilter(number){var orig=number||0;var opposite=orig==0?1:0;return selector.modifier&&selector.modifier.not?opposite:orig}var hits=0;if(selector.tag=="*"){return notfilter(true)}if(selector.id){hits++}if(selector.diggerid){hits++}if(selector.tag){hits++}if(selector.id&&notfilter(digger.id!=selector.id)){return false}if(selector.diggerid&&notfilter(digger.diggerid!=selector.diggerid)){return false}if(selector.tag&&notfilter(digger.tag!=selector.tag)){return false}if(selector.class){var keys=Object.keys(selector.class||{});var classcount=0;keys.forEach(function(c){hits++;classcount+=container.hasClass(c)?notcountfilter(1):notcountfilter(0)});if(classcount<keys.length){return false}}if(selector.attr){var attr_count=0;selector.attr.forEach(function(attr_filter){hits++;var check_value=container.attr(attr_filter.field);var operator_function=attr_compare_functions[attr_filter.operator];if(!attr_filter.value){attr_count+=check_value!==null?notcountfilter(1):notcountfilter(0)}else if(operator_function){attr_count+=operator_function.apply(null,[check_value,attr_filter.value])?notcountfilter(1):notcountfilter(0)}});if(attr_count<selector.attr.length){return false}}return hits>0}}function search(selector,context){var selector_filter=compile(selector);var search_in=context;if(selector.splitter==">"){search_in=context.children()}else if(selector.splitter=="<"){throw new Error("we do not support the parent splitter at the moment")}else{search_in=context.descendents()}var ret=search_in.filter(selector_filter);var modifier=selector.modifier||{};if(modifier.limit){var st=""+modifier.limit;if(st.indexOf(",")>=0){var parts=st.split(",").map(function(stt){return stt.replace(/\D/g,"")});ret.models=ret.models.slice(parts[0],parts[1])}else{ret.models=ret.models.slice(0,modifier.limit)}}if(modifier.first&&ret.models.length>0){ret.models=[ret.models[0]]}else if(modifier.last&&ret.models.length>0){ret.models=[ret.models[ret.models.length-1]]}return ret}},{"digger-utils":15}],19:[function(require,module,exports){module.exports=require(4)},{}],20:[function(require,module,exports){arguments[4][5][0].apply(exports,arguments)},{"./proto":21}],21:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var dotty=require("dotty");var util=require("util");var utils=require("digger-utils");function Container(){}function factory(){var models=[];if(typeof arguments[0]==="string"){var string=arguments[0];var c=string.charAt(0);if(c==="{"||c==="["){var data=JSON.parse(string);if(c==="{"){data=[data]}models=data}else{var model=arguments[1]||{};var digger=model._digger||{};digger.tag=string;model._digger=digger;models=[model]}}else if(Object.prototype.toString.call(arguments[0])=="[object Array]"){models=arguments[0]}else if(typeof arguments[0]==="object"){models=[arguments[0]]}if(models[0]===undefined||models[0]===null){models=[]}var instance=function container(){if(!instance.select){throw new Error("there is no select method attached to this container")}var args=[arguments[0]];if(arguments.length>1){args.push(arguments[1])}return instance.select.apply(instance,args)};instance.__proto__=new Container;instance.build(models);return instance}Container.factory=factory;util.inherits(Container,EventEmitter);module.exports=Container;Container.prototype.build=function(models){this.models=models||[];for(var i in models){var model=models[i];if(!model._digger){model._digger={}}if(!model._digger.diggerid){model._digger.diggerid=utils.diggerid()}}return this};Container.prototype.toJSON=function(){return this.models};Container.prototype.spawn=function(models){models=models||[];var container=Container.factory(models);if(this.supplychain){container.supplychain=this.supplychain}return container};Container.prototype.clone=function(){var data=JSON.parse(JSON.stringify(this.models));var ret=this.spawn(data);ret.recurse(function(des){var model=des.get(0);var digger=model._digger||{};digger.diggerid=utils.diggerid();model._digger=digger});ret.ensure_parent_ids();return ret};Container.prototype.ensure_parent_ids=function(parent){var self=this;if(parent){this.each(function(c){c.diggerparentid(parent.diggerid())})}this.children().each(function(child){child.ensure_parent_ids(self)})};Container.prototype.inject_paths=function(basepath){this.diggerpath(basepath);this.children().each(function(child,index){child.inject_paths(basepath.concat([index]))})};Container.prototype.ensure_meta=function(done){if(!this.diggerid()){this.diggerid(utils.diggerid())}var topcounter=0;if(this.diggerpath().length<=0){this.inject_paths([topcounter]);topcounter++}this.ensure_parent_ids();return this};Container.prototype.children=function(){var models=[];var self=this;this.each(function(container){models=models.concat(container.get(0)._children||[])});return this.spawn(models)};Container.prototype.recurse=function(fn){this.descendents().each(fn);return this};Container.prototype.descendents=function(){var ret=[];function scoopmodels(container){ret=ret.concat(container.models);container.children().each(scoopmodels)}scoopmodels(this);return this.spawn(ret)};Container.prototype.containers=function(){var self=this;return this.models.map(function(model){return self.spawn([model])})};Container.prototype.skeleton=function(){return this.models.map(function(model){return model._digger||{}})};Container.prototype.add=function(container){var self=this;if(!container){return this}if(Object.prototype.toString.call(container)=="[object Array]"){container.forEach(function(c){self.add(c)})}else{this.models=this.models.concat(container.models)}return this};Container.prototype.each=function(fn){this.containers().forEach(fn);return this};Container.prototype.map=function(fn){return this.containers().map(fn)};Container.prototype.count=function(){return this.models.length};Container.prototype.first=function(){return this.eq(0)};Container.prototype.last=function(){return this.eq(this.count()-1)};Container.prototype.eq=function(index){return this.spawn(this.get(index))};Container.prototype.get=function(index){return this.models[index]};function valuereader(model,name){if(!name){return model}return dotty.get(model,name)}function valuesetter(model,value,name){if(!name){return value}dotty.put(model,name,value);return value}function makepath(path,base){var parts=[path];if(base){parts.unshift(base)}return parts.join(".")}function wrapper(basepath){return function(path,val){var self=this;if(arguments.length<=0){if(self.isEmpty()){return null}return valuereader(self.get(0),basepath)}else if(arguments.length===1&&typeof path==="string"){if(self.isEmpty()){return null}return valuereader(self.get(0),makepath(path,basepath))}else if(arguments.length===1){self.models.forEach(function(model){valuesetter(model,val,basepath)});return self}else if(arguments.length>1){var usepath=makepath(path,basepath);self.models.forEach(function(model){valuesetter(model,val,usepath)});return self}}}function property_wrapper(basepath,property){return function(val){var self=this;if(arguments.length<=0){if(self.isEmpty()){return null}var model=dotty.get(self.get(0),basepath);return model[property]}else{if(!self.isEmpty()){self.models.forEach(function(model){var basemodel=dotty.get(model,basepath);basemodel[property]=val})}return self}}}function remove_wrapper(basepath){return function(path){var self=this;var usepath=makepath(path,basepath);self.models.forEach(function(model){dotty.remove(model,usepath)});return self}}Container.prototype.attr=wrapper();Container.prototype.digger=wrapper("_digger");Container.prototype.data=wrapper("_digger.data");Container.prototype.diggerid=property_wrapper("_digger","diggerid");Container.prototype.diggerparentid=property_wrapper("_digger","diggerparentid");Container.prototype.diggerwarehouse=property_wrapper("_digger","diggerwarehouse");var pathwrapper=property_wrapper("_digger","diggerpath");Container.prototype.diggerpath=function(){var ret=pathwrapper.apply(this,utils.toArray(arguments));if(!utils.isArray(ret)){ret=[]}return ret};var branchwrapper=property_wrapper("_digger","diggerbranch");Container.prototype.diggerbranch=function(){var ret=branchwrapper.apply(this,utils.toArray(arguments));if(!utils.isArray(ret)){ret=[]}return ret};Container.prototype.addBranch=function(where){var self=this;var branches=this.diggerbranch();where.each(function(container){branches.push(container.diggerurl())});this.diggerbranch(branches);return this};Container.prototype.removeBranch=function(where){var self=this;var branches=this.diggerbranch();where.each(function(container){var newbranches=[];for(var i=0;i<branches.length;i++){if(branches[i]!=container.diggerurl()){newbranches.push(branches[i])}}branches=newbranches});this.diggerbranch(branches);return this};Container.prototype.id=property_wrapper("_digger","id");Container.prototype.tag=property_wrapper("_digger","tag");Container.prototype.classnames=property_wrapper("_digger","class");Container.prototype.removeAttr=remove_wrapper();Container.prototype.removeDigger=remove_wrapper("_digger");Container.prototype.removeData=remove_wrapper("_digger.data");Container.prototype.is=function(tag){return this.tag()==tag};Container.prototype.addClass=function(classname){var self=this;this.models.forEach(function(model){var classnames=model._digger.class||[];var found=false;classnames.forEach(function(c){if(c==classname){found=true}});if(!found){classnames.push(classname)}model._digger.class=classnames});return this};Container.prototype.removeClass=function(classname){var self=this;this.models.forEach(function(model){var classnames=model._digger.class||[];var newclassnames=[];classnames.forEach(function(c){if(c!=classname){newclassnames.push(c)}});model._digger.class=newclassnames});return this};Container.prototype.hasClass=function(classname){var found=false;(this.classnames()||[]).forEach(function(c){if(c==classname){found=true}});return found};Container.prototype.hasAttr=function(name){var prop=this.attr(name);return prop!==null};Container.prototype.isEmpty=function(){return this.count()===0};Container.prototype.inject_data=function(data){this.models.forEach(function(model){utils.extend(model,data)});return this};Container.prototype.diggerurl=function(){var warehouse=this.diggerwarehouse();var id=this.diggerid();var url=warehouse||"/";if(id&&this.tag()!="_supplychain"){if(warehouse!="/"){url+="/"}url+=id}return url.replace(/\/\//g,"/")};Container.prototype.title=function(){var name=this.attr("name");if(!name){name=this.attr("title")}if(!name){name=this.tag()}return name};Container.prototype.summary=function(options){options=options||{};var parts=[];var title=this.attr("name")||this.attr("title")||"";if(title.length>0&&options.title!==false){parts.push(title+": ")}parts.push(this.tag());var id=this.id()||"";if(id.length>0){parts.push("#"+id)}var classnames=this.classnames()||[];if(classnames.length>0){classnames.forEach(function(classname){if(classname.match(/\w/)){parts.push("."+classname.replace(/^\s+/,"").replace(/\s+$/,""))}})}return parts.join("")};Container.prototype.toString=function(){return this.summary()}},{"digger-utils":24,dotty:19,events:37,util:38}],22:[function(require,module,exports){module.exports=require(1)},{}],23:[function(require,module,exports){module.exports=require(2)},{}],24:[function(require,module,exports){module.exports=require(3)},{extend:22,hat:23}],25:[function(require,module,exports){var process=require("__browserify_process");var Container=require("digger-container");var EventEmitter=require("events").EventEmitter;var util=require("util");var utils=require("digger-utils");module.exports=factory;function factory(handle,use_container){var supplychain=new SupplyChain(handle,use_container);return supplychain}function SupplyChain(handle,use_container){this.handle=handle;this.container=use_container||Container;this.create=use_container||Container}util.inherits(SupplyChain,EventEmitter);SupplyChain.prototype.contract=function(req,container){var self=this;if(!req.headers){req.headers={}}function trigger_request(callback){if(!self.handle||typeof self.handle!="function"){setTimeout(function(){callback("There is no handle method attached to this supplychain")},0)}else{self.handle({method:req.method,url:req.url,headers:req.headers,body:req.body},function(error,result){if(error){callback(error);return}else{if(!result){result=[]}if(!utils.isArray(result)&&typeof result==="object"){if(result.headers){result=result.body}result=[result]}if(req.results_processor){result=req.results_processor(result)}callback(null,result)}})}}req.ship=function(fn){process.nextTick(function(){trigger_request(function(error,answer){if(error){if(req._fail){req._fail(error)}else{console.log("a request has an error but the contract has no fail handler");console.dir(req.method+" "+req.url);console.log(error)}}else{fn(answer);if(req._after){req._after(answer)}}})});return this};req.fail=function(fn){req._fail=fn;return this};req.expect=function(type){if(type=="containers"){req.results_processor=function(results){return container.spawn(results)}}return this};req.after=function(fn){req._after=fn;return this};req.debug=function(){req.headers["x-debug"]=true;return this};return req};SupplyChain.prototype.connect=function(diggerwarehouse,diggerid){var self=this;if(!utils.isArray(diggerwarehouse)){if(!diggerid){diggerwarehouse=[diggerwarehouse]}}else{diggerid=null}function processurl(url){if(!url||url.length<=0){url="/"}if(url.charAt(0)!="/"){url="/"+url}return url}var models=[];if(!utils.isArray(diggerwarehouse)){diggerwarehouse=processurl(diggerwarehouse);models=[{_digger:{tag:diggerid?"item":"_supplychain",diggerwarehouse:diggerwarehouse,diggerid:diggerid}}]}else{models=diggerwarehouse.map(function(warehouseurl){warehouseurl=processurl(warehouseurl);return{_digger:{diggerwarehouse:warehouseurl,tag:"_supplychain"}}})}var container=self.container(models);container.supplychain=this;return container};SupplyChain.prototype.contract_group=function(type,contracts){var raw={method:"post",url:"/reception",headers:{"content-type":"digger/contract","x-contract-type":type},body:contracts||[]};var stub=Container();stub.supplychain=this;return this.contract(raw,stub)};SupplyChain.prototype.merge=function(contracts){return this.contract_group("merge",contracts)};SupplyChain.prototype.pipe=function(contracts){return this.contract_group("pipe",contracts)}},{__browserify_process:40,"digger-container":20,"digger-utils":24,events:37,util:38}],26:[function(require,module,exports){var SupplyChain=require("digger-supplychain");var Container=require("digger-container");Container.augment_prototype(require("digger-contracts"));Container.augment_prototype(require("digger-find"));module.exports=function(handle){var supplychain=SupplyChain(handle,Container);return supplychain};module.exports.Container=Container},{"digger-container":5,"digger-contracts":11,"digger-find":17,"digger-supplychain":25}],27:[function(require,module,exports){module.exports=WildEmitter;function WildEmitter(){this.callbacks={}}WildEmitter.prototype.on=function(event,groupName,fn){var hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];func._groupName=group;(this.callbacks[event]=this.callbacks[event]||[]).push(func);return this};WildEmitter.prototype.once=function(event,groupName,fn){var self=this,hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];function on(){self.off(event,on);func.apply(this,arguments)}this.on(event,group,on);return this};WildEmitter.prototype.releaseGroup=function(groupName){var item,i,len,handlers;for(item in this.callbacks){handlers=this.callbacks[item];for(i=0,len=handlers.length;i<len;i++){if(handlers[i]._groupName===groupName){handlers.splice(i,1);i--;len--}}}return this};WildEmitter.prototype.off=function(event,fn){var callbacks=this.callbacks[event],i;if(!callbacks)return this;if(arguments.length===1){delete this.callbacks[event];return this}i=callbacks.indexOf(fn);callbacks.splice(i,1);return this};WildEmitter.prototype.emit=function(event){var args=[].slice.call(arguments,1),callbacks=this.callbacks[event],specialCallbacks=this.getWildcardCallbacks(event),i,len,item;if(callbacks){for(i=0,len=callbacks.length;i<len;++i){if(callbacks[i]){callbacks[i].apply(this,args)}else{break}}}if(specialCallbacks){for(i=0,len=specialCallbacks.length;i<len;++i){if(specialCallbacks[i]){specialCallbacks[i].apply(this,[event].concat(args))}else{break}}}return this};WildEmitter.prototype.getWildcardCallbacks=function(eventName){var item,split,result=[];for(item in this.callbacks){split=item.split("*");if(item==="*"||split.length===2&&eventName.slice(0,split[1].length)===split[1]){result=result.concat(this.callbacks[item])}}return result}},{}],28:[function(require,module,exports){var Emitter=require("wildemitter");module.exports=function(basepath){function get_channel(st){if(!st){st="*"}return(basepath?basepath:"")+st}var radio=new Emitter({});var channels=new Emitter({});radio.talk=function(channel,body){channels.emit(get_channel(channel),body)};radio.listen=function(channel,fn){if(!fn){fn=channel;channel="*"}channel=get_channel(channel);channels.on(channel,fn);radio.emit("listen",channel)};radio.cancel=function(channel,fn){var emitterkey=get_channel(channel);if(fn){channels.off(emitterkey,fn)}else{channels.off(emitterkey)}var listeners=channels.getWildcardCallbacks(emitterkey);if(listeners.length<=0){radio.emit("cancel",channel.replace(/\*$/,""))}};radio.receive=function(channel,body){channels.emit(channel,body,channel)};return radio};module.exports.container_wrapper=function(radio,container){function get_channel(channel){if(!channel){channel="*"}var base=container.diggerwarehouse().replace(/^\//,"").replace(/\//g,".")+"."+(container.diggerpath()||[]).join(".");var st=base;if(channel.match(/[\w\*]/)){st=base+channel}return st}return{talk:function(channel,packet){if(arguments.length<2){packet=channel;channel=""}channel=get_channel(channel);return radio.talk(channel,packet)},listen:function(channel,fn){channel=get_channel(channel);return radio.listen(channel,fn)},cancel:function(channel,fn){channel=get_channel(channel);return radio.cancel(channel,fn)}}}},{wildemitter:27}],29:[function(require,module,exports){module.exports=require(1)},{}],30:[function(require,module,exports){module.exports=require(2)},{}],31:[function(require,module,exports){module.exports=require(10)},{extend:29,hat:30}],32:[function(require,module,exports){module.exports=function(){var blueprints={};var holder=null;function ensure_holder(){if(!holder){holder=$digger.create()}return holder}return{load:function(warehouses,done){var self=this;var blueprintwarehouse=$digger.connect(warehouses);blueprintwarehouse("blueprint:tree").ship(function(blueprints){blueprints.find("blueprint").each(function(blueprint){if($digger.config.debug){console.log("-------------------------------------------");console.log("adding blueprint: "+blueprint.attr("name"))}self.add(blueprint)});blueprints.find("template").each(function(template){$digger.template.add(template.attr("name"),template.attr("html"))});blueprints.find("controller").each(function(controller){var src=controller.attr("src");if($digger.config.debug){console.log("-------------------------------------------");console.log("adding controller: "+controller.attr("name"));console.log(src)}try{eval.call(window,src)}catch(e){console.log("-------------------------------------------");console.log("ERROR: ");console.log(e);console.log(e.stack)}});done&&done()})},reset:function(){blueprints={};holder=$digger.create()},add:function(blueprint){this.process(blueprint);ensure_holder();holder.add(blueprint);blueprints[blueprint.title()]=blueprint;return this},process:function(blueprint){function map_field(field){var ret=field.get(0);ret.options=field.find("option").map(function(o){return o.attr("value")});return ret}if(typeof blueprint.find==="function"){var tabs=blueprint.find("tab");var fields=blueprint.find("> field").map(map_field);var tabs=blueprint.find("tab").map(function(tab){var model=tab.get(0);if(tab.attr("type")){return model}else{model.fields=tab.find("field").map(map_field)}return model});blueprint.fields=fields;blueprint.tabs=tabs}else{blueprint.fields=[]}},has_children:function(for_blueprint){if(!for_blueprint||!for_blueprint.attr("leaf")){return true}else{return false}},get_add_children:function(for_blueprint){ensure_holder();if(!for_blueprint){return holder}if(for_blueprint.attr("leaf")){return null}if(for_blueprint.attr("children")){return holder.find(for_blueprint.attr("children"))}else{return holder}},get_children:function(for_blueprint){return this.get_add_children(for_blueprint)},get:function(name){if(arguments.length<=0){return blueprints}return blueprints[name]},all_containers:function(){return holder.containers()},all:function(){var ret={};for(var prop in blueprints){ret[prop]=blueprints[prop]}return ret},create:function(name){var blueprint=this.get(name);if(!blueprint){return $digger.create(name,{})}var data=blueprint?{_digger:{tag:blueprint.attr("tag")||blueprint.attr("name"),"class":blueprint.attr("class")||[]}}:{};blueprint.find("field").each(function(field){var name=field.attr("name");var def=field.attr("default");if(def){data[name]=def}});var container=$digger.create([data]);container.data("new",true);return container}}}},{}],"digger-sockets":[function(require,module,exports){module.exports=require("E9YBgr")},{}],E9YBgr:[function(require,module,exports){var utils=require("digger-utils");var Blueprint=require("./blueprints");var Template=require("./templates");var Radio=require("digger-radio");var Client=require("digger-client");module.exports=function(config){config=config||{};var $digger;if(config.debug){console.log("-------------------------------------------");console.log("-------------------------------------------");console.log("CONFIG");console.dir(config)}var cloneuser=null;if(config.user){cloneuser=config.user;cloneuser=JSON.parse(JSON.stringify(cloneuser))}var socket=new SockJS("//"+(config.host||"localhost")+"/digger/sockets");var request_buffer=[];var socketconnected=false;var callbacks={};function padding(offset){offset=offset||0;var st="";for(var i=0;i<offset;i++){st+="    "}return st}function is_contract(req){return req.url=="/reception"&&req.method=="post"}function log_contract(contract,offset){console.log(padding(offset)+"-------------------------------------------");console.log(padding(offset)+"contract: "+contract.headers["x-contract-type"]);offset++;var summary=[];(contract.body||[]).forEach(function(child){summary.push(log_request(child,offset))});return"contract: "+summary.join(" "+contract.headers["x-contract-type"]+" ")}function log_warehouse_request(req,offset){var extra="";if(req.headers["x-json-selector"]){var selector=req.headers["x-json-selector"];extra=" - select: "+selector.string}var summary="request: "+req.method+" "+req.url+extra;console.log(padding(offset)+"-------------------------------------------");console.log(padding(offset)+summary);return summary}function log_request(packet,offset){offset=offset||0;var summary="";if(is_contract(packet)){summary=log_contract(packet,offset)}else{summary=log_warehouse_request(packet,offset)}return summary}function log_response_factory(summary){return function(answer){var extra="";if(answer.error){extra="ERROR: "+answer.error}else{extra=summary}console.log("-------------------------------------------");console.log("ANSWER");console.log(extra);console.log("-------------------------------------------");console.dir(answer.results);console.log("-------------------------------------------")}}function clear_buffer(){var usebuffer=[].concat(request_buffer);usebuffer.forEach(function(buffered_request){if(buffered_request.fn){buffered_request.fn()}else if(buffered_request.req){run_socket(buffered_request.req,buffered_request.reply)}});request_buffer=[]}function disconnected_handler(req,reply){if($digger.config.debug){console.log("buffer request");console.dir(req)}request_buffer.push({req:req,reply:reply})}function connected_handler(req,reply){if(!req||!req.url||!req.method){throw new Error("req must have a url and method")}var headers=req.headers||{};var http_req={id:utils.littleid(),method:req.method,url:req.url,headers:headers,body:req.body};var log_response=null;if($digger.config.debug){log_response=log_response_factory(log_request(req))}callbacks[http_req.id]=function(answer){var error=answer.error;var results=answer.results;reply(error,results);if($digger.config.debug){log_response(answer)}delete callbacks[http_req.id]};socket.send(JSON.stringify({type:"request",data:http_req}))}function socket_is_ready(){if(!socketconnected){socketconnected=true;clear_buffer();$digger.emit("connect");$digger.emit("ready")}}function socket_answer(payload){payload=payload.toString();payload=JSON.parse(payload);if(payload.type=="response"){var answer=payload.data;var id=answer.id;var callback=callbacks[id];if(callback){callback(answer)}}else if(payload.type=="auth"){socket_is_ready()}else if(payload.type=="radio"){var packet=payload.data;$digger.radio.receive(packet.channel,packet.payload)}else if(payload.type=="error"){console.error("socket error: "+payload.error)}else{console.error("unknown payload type: "+payload.type)}}function bufferred_write(req){function do_write(){socket.send(req)}if(socketconnected){do_write()}else{request_buffer.push({fn:do_write})}}function run_socket(req,reply){if(socketconnected){connected_handler(req,reply)}else{disconnected_handler(req,reply)}}socket.onopen=function(){if(config.debug){console.log("socket connected")}if($digger.config.user){socket.send(JSON.stringify({type:"auth",data:$digger.config.user}))}else{socket_is_ready()}};socket.onmessage=function(e){if(e.type==="message"){socket_answer(e.data)}else if(e.type==="radio"){var channel=e.data.channel;var payload=e.data.payload}};socket.onclose=function(){if(config.debug){console.log("socket disconnected")}socketconnected=false;$digger.emit("disconnect")};$digger=Client(run_socket);$digger.config=config;$digger.user=cloneuser;if($digger.user){$digger.user._fullname=cloneuser.fullname}$digger.blueprint=Blueprint();$digger.template=Template();function connect_radio(radio){function send_packet(action,channel,payload){bufferred_write(JSON.stringify({type:"radio",data:{action:action,channel:channel,payload:payload}}))}radio.on("talk",function(channel,payload){send_packet("talk",channel,payload)});radio.on("listen",function(channel){send_packet("listen",channel)});radio.on("cancel",function(channel){send_packet("cancel",channel)});return radio}$digger.radio=connect_radio(Radio());Client.Container.augment_prototype({radio:function(){return Radio.container_wrapper($digger.radio,this)}});return $digger}},{"./blueprints":32,"./templates":35,"digger-client":26,"digger-radio":28,"digger-utils":31}],35:[function(require,module,exports){module.exports=function(){return{templates:{},add:function(name,plate){if($digger.config.debug){console.log("-------------------------------------------");console.log("adding template: "+name);console.dir(plate)}this.templates[name]=plate.replace(/^\s+/,"").replace(/\s+$/);return this},get:function(name){if(arguments.length<=0){return this.templates}return this.templates[name]}}}},{}],36:[function(require,module,exports){var toString=Object.prototype.toString;var hasOwnProperty=Object.prototype.hasOwnProperty;function isArray(xs){return toString.call(xs)==="[object Array]"}exports.isArray=typeof Array.isArray==="function"?Array.isArray:isArray;exports.indexOf=function indexOf(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(x===xs[i])return i}return-1};exports.filter=function filter(xs,fn){if(xs.filter)return xs.filter(fn);var res=[];for(var i=0;i<xs.length;i++){if(fn(xs[i],i,xs))res.push(xs[i])}return res};exports.forEach=function forEach(xs,fn,self){if(xs.forEach)return xs.forEach(fn,self);for(var i=0;i<xs.length;i++){fn.call(self,xs[i],i,xs)}};exports.map=function map(xs,fn){if(xs.map)return xs.map(fn);var out=new Array(xs.length);for(var i=0;i<xs.length;i++){out[i]=fn(xs[i],i,xs)}return out};exports.reduce=function reduce(array,callback,opt_initialValue){if(array.reduce)return array.reduce(callback,opt_initialValue);var value,isValueSet=false;if(2<arguments.length){value=opt_initialValue;isValueSet=true}for(var i=0,l=array.length;l>i;++i){if(array.hasOwnProperty(i)){if(isValueSet){value=callback(value,array[i],i,array)}else{value=array[i];isValueSet=true}}}return value};if("ab".substr(-1)!=="b"){exports.substr=function(str,start,length){if(start<0)start=str.length+start;return str.substr(start,length)}}else{exports.substr=function(str,start,length){return str.substr(start,length)}}exports.trim=function(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")};exports.bind=function(){var args=Array.prototype.slice.call(arguments);var fn=args.shift();if(fn.bind)return fn.bind.apply(fn,args);var self=args.shift();return function(){fn.apply(self,args.concat([Array.prototype.slice.call(arguments)]))}};function create(prototype,properties){var object;if(prototype===null){object={__proto__:null}}else{if(typeof prototype!=="object"){throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'")}var Type=function(){};Type.prototype=prototype;object=new Type;object.__proto__=prototype}if(typeof properties!=="undefined"&&Object.defineProperties){Object.defineProperties(object,properties)}return object}exports.create=typeof Object.create==="function"?Object.create:create;function notObject(object){return typeof object!="object"&&typeof object!="function"||object===null}function keysShim(object){if(notObject(object)){throw new TypeError("Object.keys called on a non-object")}var result=[];for(var name in object){if(hasOwnProperty.call(object,name)){result.push(name)}}return result}function propertyShim(object){if(notObject(object)){throw new TypeError("Object.getOwnPropertyNames called on a non-object")
}var result=keysShim(object);if(exports.isArray(object)&&exports.indexOf(object,"length")===-1){result.push("length")}return result}var keys=typeof Object.keys==="function"?Object.keys:keysShim;var getOwnPropertyNames=typeof Object.getOwnPropertyNames==="function"?Object.getOwnPropertyNames:propertyShim;if((new Error).hasOwnProperty("description")){var ERROR_PROPERTY_FILTER=function(obj,array){if(toString.call(obj)==="[object Error]"){array=exports.filter(array,function(name){return name!=="description"&&name!=="number"&&name!=="message"})}return array};exports.keys=function(object){return ERROR_PROPERTY_FILTER(object,keys(object))};exports.getOwnPropertyNames=function(object){return ERROR_PROPERTY_FILTER(object,getOwnPropertyNames(object))}}else{exports.keys=keys;exports.getOwnPropertyNames=getOwnPropertyNames}function valueObject(value,key){return{value:value[key]}}if(typeof Object.getOwnPropertyDescriptor==="function"){try{Object.getOwnPropertyDescriptor({a:1},"a");exports.getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor}catch(e){exports.getOwnPropertyDescriptor=function(value,key){try{return Object.getOwnPropertyDescriptor(value,key)}catch(e){return valueObject(value,key)}}}}else{exports.getOwnPropertyDescriptor=valueObject}},{}],37:[function(require,module,exports){var util=require("util");function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!util.isNumber(n)||n<0)throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||util.isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{throw TypeError('Uncaught, unspecified "error" event.')}return false}}handler=this._events[type];if(util.isUndefined(handler))return false;if(util.isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(util.isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!util.isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,util.isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(util.isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(util.isObject(this._events[type])&&!this._events[type].warned){var m;if(!util.isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);console.trace()}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!util.isFunction(listener))throw TypeError("listener must be a function");function g(){this.removeListener(type,g);listener.apply(this,arguments)}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!util.isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||util.isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(util.isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(util.isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(util.isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(util.isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret}},{util:38}],38:[function(require,module,exports){var Buffer=require("__browserify_Buffer").Buffer;var shims=require("_shims");var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};shims.forEach(array,function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=shims.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=shims.getOwnPropertyNames(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}shims.forEach(keys,function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=shims.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(shims.indexOf(ctx.seen,desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=shims.reduce(output,function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return shims.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&objectToString(e)==="[object Error]"}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return arg instanceof Buffer}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=function(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=shims.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})};exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=shims.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}},{__browserify_Buffer:39,_shims:36}],39:[function(require,module,exports){require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){exports.readIEEE754=function(buffer,offset,isBE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isBE?0:nBytes-1,d=isBE?1:-1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.writeIEEE754=function(buffer,value,offset,isBE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isBE?nBytes-1:0,d=isBE?-1:1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],q9TxCC:[function(require,module,exports){var assert;exports.Buffer=Buffer;exports.SlowBuffer=Buffer;Buffer.poolSize=8192;exports.INSPECT_MAX_BYTES=50;function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function Buffer(subject,encoding,offset){if(!assert)assert=require("assert");if(!(this instanceof Buffer)){return new Buffer(subject,encoding,offset)}this.parent=this;this.offset=0;if(encoding=="base64"&&typeof subject=="string"){subject=stringtrim(subject);while(subject.length%4!=0){subject=subject+"="}}var type;if(typeof offset==="number"){this.length=coerce(encoding);for(var i=0;i<this.length;i++){this[i]=subject.get(i+offset)}}else{switch(type=typeof subject){case"number":this.length=coerce(subject);break;case"string":this.length=Buffer.byteLength(subject,encoding);break;case"object":this.length=coerce(subject.length);break;default:throw new Error("First argument needs to be a number, "+"array or string.")}if(isArrayIsh(subject)){for(var i=0;i<this.length;i++){if(subject instanceof Buffer){this[i]=subject.readUInt8(i)}else{this[i]=subject[i]}}}else if(type=="string"){this.length=this.write(subject,0,encoding)}else if(type==="number"){for(var i=0;i<this.length;i++){this[i]=0}}}}Buffer.prototype.get=function get(i){if(i<0||i>=this.length)throw new Error("oob");return this[i]};Buffer.prototype.set=function set(i,v){if(i<0||i>=this.length)throw new Error("oob");return this[i]=v};Buffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":case"binary":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};Buffer.prototype.utf8Write=function(string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(utf8ToBytes(string),this,offset,length)};Buffer.prototype.asciiWrite=function(string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(asciiToBytes(string),this,offset,length)};Buffer.prototype.binaryWrite=Buffer.prototype.asciiWrite;Buffer.prototype.base64Write=function(string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(base64ToBytes(string),this,offset,length)};Buffer.prototype.base64Slice=function(start,end){var bytes=Array.prototype.slice.apply(this,arguments);return require("base64-js").fromByteArray(bytes)};Buffer.prototype.utf8Slice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var res="";var tmp="";var i=0;while(i<bytes.length){if(bytes[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(bytes[i]);tmp=""}else tmp+="%"+bytes[i].toString(16);i++}return res+decodeUtf8Char(tmp)};Buffer.prototype.asciiSlice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var ret="";for(var i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret};Buffer.prototype.binarySlice=Buffer.prototype.asciiSlice;Buffer.prototype.inspect=function(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.hexSlice=function(start,end){var len=this.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(this[i])}return out};Buffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();start=+start||0;if(typeof end=="undefined")end=this.length;if(+end==start){return""}switch(encoding){case"hex":return this.hexSlice(start,end);case"utf8":case"utf-8":return this.utf8Slice(start,end);case"ascii":return this.asciiSlice(start,end);case"binary":return this.binarySlice(start,end);case"base64":return this.base64Slice(start,end);case"ucs2":case"ucs-2":return this.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};Buffer.prototype.hexWrite=function(string,offset,length){offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2){throw new Error("Invalid hex string")}if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");this[offset+i]=byte}Buffer._charsWritten=i*2;return i};Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return this.hexWrite(string,offset,length);case"utf8":case"utf-8":return this.utf8Write(string,offset,length);case"ascii":return this.asciiWrite(string,offset,length);case"binary":return this.binaryWrite(string,offset,length);case"base64":return this.base64Write(string,offset,length);case"ucs2":case"ucs-2":return this.ucs2Write(string,offset,length);default:throw new Error("Unknown encoding")}};function clamp(index,len,defaultValue){if(typeof index!=="number")return defaultValue;index=~~index;if(index>=len)return len;if(index>=0)return index;index+=len;if(index>=0)return index;return 0}Buffer.prototype.slice=function(start,end){var len=this.length;start=clamp(start,len,0);end=clamp(end,len,len);return new Buffer(this,end-start,+start)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;start||(start=0);if(end===undefined||isNaN(end)){end=this.length}target_start||(target_start=0);if(end<start)throw new Error("sourceEnd < sourceStart");if(end===start)return 0;if(target.length==0||source.length==0)return 0;if(target_start<0||target_start>=target.length){throw new Error("targetStart out of bounds")}if(start<0||start>=source.length){throw new Error("sourceStart out of bounds")}if(end<0||end>source.length){throw new Error("sourceEnd out of bounds")}if(end>this.length){end=this.length}if(target.length-target_start<end-start){end=target.length-target_start+start}var temp=[];for(var i=start;i<end;i++){assert.ok(typeof this[i]!=="undefined","copying undefined buffer bytes!");temp.push(this[i])}for(var i=target_start;i<target_start+temp.length;i++){target[i]=temp[i-target_start]}};Buffer.prototype.fill=function fill(value,start,end){value||(value=0);start||(start=0);end||(end=this.length);if(typeof value==="string"){value=value.charCodeAt(0)}if(!(typeof value==="number")||isNaN(value)){throw new Error("value is not a number")}if(end<start)throw new Error("end < start");if(end===start)return 0;if(this.length==0)return 0;if(start<0||start>=this.length){throw new Error("start out of bounds")}if(end<0||end>this.length){throw new Error("end out of bounds")}for(var i=start;i<end;i++){this[i]=value}};Buffer.isBuffer=function isBuffer(b){return b instanceof Buffer||b instanceof Buffer};Buffer.concat=function(list,totalLength){if(!isArray(list)){throw new Error("Usage: Buffer.concat(list, [totalLength])\n       list should be an Array.")}if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}if(typeof totalLength!=="number"){totalLength=0;for(var i=0;i<list.length;i++){var buf=list[i];totalLength+=buf.length}}var buffer=new Buffer(totalLength);var pos=0;for(var i=0;i<list.length;i++){var buf=list[i];buf.copy(buffer,pos);pos+=buf.length}return buffer};Buffer.isEncoding=function(encoding){switch((encoding+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function isArray(subject){return(Array.isArray||function(subject){return{}.toString.apply(subject)=="[object Array]"})(subject)}function isArrayIsh(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)byteArray.push(str.charCodeAt(i)&255);return byteArray}function base64ToBytes(str){return require("base64-js").toByteArray(str)}function blitBuffer(src,dst,offset,length){var pos,i=0;while(i<length){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i];i++}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}Buffer.prototype.readUInt8=function(offset,noAssert){var buffer=this;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return;return buffer[offset]};function readUInt16(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return 0;if(isBigEndian){val=buffer[offset]<<8;if(offset+1<buffer.length){val|=buffer[offset+1]}}else{val=buffer[offset];if(offset+1<buffer.length){val|=buffer[offset+1]<<8}}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,false,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,true,noAssert)};function readUInt32(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return 0;if(isBigEndian){if(offset+1<buffer.length)val=buffer[offset+1]<<16;if(offset+2<buffer.length)val|=buffer[offset+2]<<8;if(offset+3<buffer.length)val|=buffer[offset+3];val=val+(buffer[offset]<<24>>>0)}else{if(offset+2<buffer.length)val=buffer[offset+2]<<16;if(offset+1<buffer.length)val|=buffer[offset+1]<<8;val|=buffer[offset];if(offset+3<buffer.length)val=val+(buffer[offset+3]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,false,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,true,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){var buffer=this;var neg;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return;neg=buffer[offset]&128;if(!neg){return buffer[offset]}return(255-buffer[offset]+1)*-1};function readInt16(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}val=readUInt16(buffer,offset,isBigEndian,noAssert);neg=val&32768;if(!neg){return val}return(65535-val+1)*-1}Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,false,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,true,noAssert)};function readInt32(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}val=readUInt32(buffer,offset,isBigEndian,noAssert);neg=val&2147483648;if(!neg){return val}return(4294967295-val+1)*-1}Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,false,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,true,noAssert)};function readFloat(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,false,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,true,noAssert)};function readDouble(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+7<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,false,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,true,noAssert)};function verifuint(value,max){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value>=0,"specified a negative value for writing an unsigned value");assert.ok(value<=max,"value is larger than maximum value for type");assert.ok(Math.floor(value)===value,"value has a fractional component")}Buffer.prototype.writeUInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"trying to write beyond buffer length");verifuint(value,255)}if(offset<buffer.length){buffer[offset]=value}};function writeUInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"trying to write beyond buffer length");verifuint(value,65535)}for(var i=0;i<Math.min(buffer.length-offset,2);i++){buffer[offset+i]=(value&255<<8*(isBigEndian?1-i:i))>>>(isBigEndian?1-i:i)*8}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){writeUInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){writeUInt16(this,value,offset,true,noAssert)};function writeUInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"trying to write beyond buffer length");verifuint(value,4294967295)}for(var i=0;i<Math.min(buffer.length-offset,4);i++){buffer[offset+i]=value>>>(isBigEndian?3-i:i)*8&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){writeUInt32(this,value,offset,true,noAssert)};function verifsint(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value");assert.ok(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value")}Buffer.prototype.writeInt8=function(value,offset,noAssert){var buffer=this;
if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(value>=0){buffer.writeUInt8(value,offset,noAssert)}else{buffer.writeUInt8(255+value+1,offset,noAssert)}};function writeInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}if(value>=0){writeUInt16(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt16(buffer,65535+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){writeInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){writeInt16(this,value,offset,true,noAssert)};function writeInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}if(value>=0){writeUInt32(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt32(buffer,4294967295+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){writeInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){writeInt32(this,value,offset,true,noAssert)};function writeFloat(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,23,4)}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){writeFloat(this,value,offset,false,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){writeFloat(this,value,offset,true,noAssert)};function writeDouble(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+7<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,52,8)}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){writeDouble(this,value,offset,true,noAssert)}},{"./buffer_ieee754":1,assert:6,"base64-js":4}],"buffer-browserify":[function(require,module,exports){module.exports=require("q9TxCC")},{}],4:[function(require,module,exports){(function(exports){"use strict";var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw"Invalid string. Length must be a multiple of 4"}placeHolders=b64.indexOf("=");placeHolders=placeHolders>0?b64.length-placeHolders:0;arr=[];l=placeHolders>0?b64.length-4:b64.length;for(i=0,j=0;i<l;i+=4,j+=3){tmp=lookup.indexOf(b64[i])<<18|lookup.indexOf(b64[i+1])<<12|lookup.indexOf(b64[i+2])<<6|lookup.indexOf(b64[i+3]);arr.push((tmp&16711680)>>16);arr.push((tmp&65280)>>8);arr.push(tmp&255)}if(placeHolders===2){tmp=lookup.indexOf(b64[i])<<2|lookup.indexOf(b64[i+1])>>4;arr.push(tmp&255)}else if(placeHolders===1){tmp=lookup.indexOf(b64[i])<<10|lookup.indexOf(b64[i+1])<<4|lookup.indexOf(b64[i+2])>>2;arr.push(tmp>>8&255);arr.push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=lookup[temp>>2];output+=lookup[temp<<4&63];output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=lookup[temp>>10];output+=lookup[temp>>4&63];output+=lookup[temp<<2&63];output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64})()},{}],5:[function(require,module,exports){var toString=Object.prototype.toString;var hasOwnProperty=Object.prototype.hasOwnProperty;function isArray(xs){return toString.call(xs)==="[object Array]"}exports.isArray=typeof Array.isArray==="function"?Array.isArray:isArray;exports.indexOf=function indexOf(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(x===xs[i])return i}return-1};exports.filter=function filter(xs,fn){if(xs.filter)return xs.filter(fn);var res=[];for(var i=0;i<xs.length;i++){if(fn(xs[i],i,xs))res.push(xs[i])}return res};exports.forEach=function forEach(xs,fn,self){if(xs.forEach)return xs.forEach(fn,self);for(var i=0;i<xs.length;i++){fn.call(self,xs[i],i,xs)}};exports.map=function map(xs,fn){if(xs.map)return xs.map(fn);var out=new Array(xs.length);for(var i=0;i<xs.length;i++){out[i]=fn(xs[i],i,xs)}return out};exports.reduce=function reduce(array,callback,opt_initialValue){if(array.reduce)return array.reduce(callback,opt_initialValue);var value,isValueSet=false;if(2<arguments.length){value=opt_initialValue;isValueSet=true}for(var i=0,l=array.length;l>i;++i){if(array.hasOwnProperty(i)){if(isValueSet){value=callback(value,array[i],i,array)}else{value=array[i];isValueSet=true}}}return value};if("ab".substr(-1)!=="b"){exports.substr=function(str,start,length){if(start<0)start=str.length+start;return str.substr(start,length)}}else{exports.substr=function(str,start,length){return str.substr(start,length)}}exports.trim=function(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")};exports.bind=function(){var args=Array.prototype.slice.call(arguments);var fn=args.shift();if(fn.bind)return fn.bind.apply(fn,args);var self=args.shift();return function(){fn.apply(self,args.concat([Array.prototype.slice.call(arguments)]))}};function create(prototype,properties){var object;if(prototype===null){object={__proto__:null}}else{if(typeof prototype!=="object"){throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'")}var Type=function(){};Type.prototype=prototype;object=new Type;object.__proto__=prototype}if(typeof properties!=="undefined"&&Object.defineProperties){Object.defineProperties(object,properties)}return object}exports.create=typeof Object.create==="function"?Object.create:create;function notObject(object){return typeof object!="object"&&typeof object!="function"||object===null}function keysShim(object){if(notObject(object)){throw new TypeError("Object.keys called on a non-object")}var result=[];for(var name in object){if(hasOwnProperty.call(object,name)){result.push(name)}}return result}function propertyShim(object){if(notObject(object)){throw new TypeError("Object.getOwnPropertyNames called on a non-object")}var result=keysShim(object);if(exports.isArray(object)&&exports.indexOf(object,"length")===-1){result.push("length")}return result}var keys=typeof Object.keys==="function"?Object.keys:keysShim;var getOwnPropertyNames=typeof Object.getOwnPropertyNames==="function"?Object.getOwnPropertyNames:propertyShim;if((new Error).hasOwnProperty("description")){var ERROR_PROPERTY_FILTER=function(obj,array){if(toString.call(obj)==="[object Error]"){array=exports.filter(array,function(name){return name!=="description"&&name!=="number"&&name!=="message"})}return array};exports.keys=function(object){return ERROR_PROPERTY_FILTER(object,keys(object))};exports.getOwnPropertyNames=function(object){return ERROR_PROPERTY_FILTER(object,getOwnPropertyNames(object))}}else{exports.keys=keys;exports.getOwnPropertyNames=getOwnPropertyNames}function valueObject(value,key){return{value:value[key]}}if(typeof Object.getOwnPropertyDescriptor==="function"){try{Object.getOwnPropertyDescriptor({a:1},"a");exports.getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor}catch(e){exports.getOwnPropertyDescriptor=function(value,key){try{return Object.getOwnPropertyDescriptor(value,key)}catch(e){return valueObject(value,key)}}}}else{exports.getOwnPropertyDescriptor=valueObject}},{}],6:[function(require,module,exports){var util=require("util");var shims=require("_shims");var pSlice=Array.prototype.slice;var assert=module.exports=ok;assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;this.message=options.message||getMessage(this)};util.inherits(assert.AssertionError,Error);function replacer(key,value){if(util.isUndefined(value)){return""+value}if(util.isNumber(value)&&(isNaN(value)||!isFinite(value))){return value.toString()}if(util.isFunction(value)||util.isRegExp(value)){return value.toString()}return value}function truncate(s,n){if(util.isString(s)){return s.length<n?s:s.slice(0,n)}else{return s}}function getMessage(self){return truncate(JSON.stringify(self.actual,replacer),128)+" "+self.operator+" "+truncate(JSON.stringify(self.expected,replacer),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};function _deepEqual(actual,expected){if(actual===expected){return true}else if(util.isBuffer(actual)&&util.isBuffer(expected)){if(actual.length!=expected.length)return false;for(var i=0;i<actual.length;i++){if(actual[i]!==expected[i])return false}return true}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if(!util.isObject(actual)&&!util.isObject(expected)){return actual==expected}else{return objEquiv(actual,expected)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b){if(util.isNullOrUndefined(a)||util.isNullOrUndefined(b))return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false}a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b)}try{var ka=shims.keys(a),kb=shims.keys(b),key,i}catch(e){return false}if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key]))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}else if(actual instanceof expected){return true}else if(expected.call({},actual)===true){return true}return false}function _throws(shouldThrow,block,expected,message){var actual;if(util.isString(expected)){message=expected;expected=null}try{block()}catch(e){actual=e}message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}if(!shouldThrow&&expectedException(actual,expected)){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws.apply(this,[true].concat(pSlice.call(arguments)))};assert.doesNotThrow=function(block,message){_throws.apply(this,[false].concat(pSlice.call(arguments)))};assert.ifError=function(err){if(err){throw err}}},{_shims:5,util:7}],7:[function(require,module,exports){var shims=require("_shims");var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};shims.forEach(array,function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=shims.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=shims.getOwnPropertyNames(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}shims.forEach(keys,function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=shims.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(shims.indexOf(ctx.seen,desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=shims.reduce(output,function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return shims.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&objectToString(e)==="[object Error]"}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return arg instanceof Buffer}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=function(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=shims.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})};exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=shims.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}},{_shims:5}]},{},[]);module.exports=require("buffer-browserify")},{}],40:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){if(ev.source===window&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}]},{},[]);