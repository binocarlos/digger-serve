require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty;function isPlainObject(obj){if(!obj||toString.call(obj)!=="[object Object]"||obj.nodeType||obj.setInterval)return false;var has_own_constructor=hasOwnProperty.call(obj,"constructor");var has_is_property_of_method=hasOwnProperty.call(obj.constructor.prototype,"isPrototypeOf");if(obj.constructor&&!has_own_constructor&&!has_is_property_of_method)return false;var key;for(key in obj){}return key===undefined||hasOwn.call(obj,key)}module.exports=function extend(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&typeof target!=="function"){target={}}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[]}else{clone=src&&isPlainObject(src)?src:{}}target[name]=extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target}},{}],2:[function(require,module,exports){var hat=module.exports=function(bits,base){if(!base)base=16;if(bits===undefined)bits=128;if(bits<=0)return"0";var digits=Math.log(Math.pow(2,bits))/Math.log(base);for(var i=2;digits===Infinity;i*=2){digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i}var rem=digits-Math.floor(digits);var res="";for(var i=0;i<Math.floor(digits);i++){var x=Math.floor(Math.random()*base).toString(base);res=x+res}if(rem){var b=Math.pow(base,rem);var x=Math.floor(Math.random()*b).toString(base);res=x+res}var parsed=parseInt(res,base);if(parsed!==Infinity&&parsed>=Math.pow(2,bits)){return hat(bits,base)}else return res};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters++>10){if(expandBy)bits+=expandBy;else throw new Error("too many ID collisions, use more bits")}var id=hat(bits,base)}while(Object.hasOwnProperty.call(hats,id));hats[id]=data;return id};var hats=fn.hats={};fn.get=function(id){return fn.hats[id]};fn.set=function(id,value){fn.hats[id]=value;return fn};fn.bits=bits||128;fn.base=base||16;return fn}},{}],3:[function(require,module,exports){var extend=require("extend");var hat=require("hat");var utils=module.exports={};utils.diggerid=function(){return hat()};utils.littleid=function(chars){chars=chars||6;var pattern="";for(var i=0;i<chars;i++){pattern+="x"}return pattern.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};utils.escapeRegexp=function(search){return search.replace(/([\!\$\(\)\*\+\.\/\:\=\?\[\\\]\^\{\|\}])/g,"\\$1")};utils.json_request=function(req){return{method:req.method.toLowerCase(),url:req.url,body:req.body,headers:req.headers}};utils.isArray=function(arr){return Object.prototype.toString.call(arr)=="[object Array]"};utils.toArray=function(args){return Array.prototype.slice.call(args,0)};utils.extend=extend},{extend:1,hat:2}],4:[function(require,module,exports){var exists=module.exports.exists=function exists(object,path){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return false}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return false}if(path.length===0){return Object.hasOwnProperty.apply(object,[key])}else{return exists(object[key],path)}};var get=module.exports.get=function get(object,path){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return}if(path.length===0){return object[key]}if(path.length){return get(object[key],path)}};var search=module.exports.search=function search(object,path){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return}if(key==="*"){key=".*"}if(typeof key==="string"){key=new RegExp(key)}if(path.length===0){return Object.keys(object).filter(key.test.bind(key)).map(function(k){return object[k]})}else{return Array.prototype.concat.apply([],Object.keys(object).filter(key.test.bind(key)).map(function(k){return search(object[k],path)}))}};var put=module.exports.put=function put(object,path,value){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return false}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return false}if(path.length===0){object[key]=value}else{if(typeof object[key]==="undefined"){object[key]={}}if(typeof object[key]!=="object"||object[key]===null){return false}return put(object[key],path,value)}};var remove=module.exports.remove=function remove(object,path,value){if(typeof path==="string"){path=path.split(".")}if(!(path instanceof Array)||path.length===0){return false}path=path.slice();var key=path.shift();if(typeof object!=="object"||object===null){return false}if(path.length===0){if(!Object.hasOwnProperty.call(object,key)){return false}delete object[key];return true}else{return remove(object[key],path,value)}};var deepKeys=module.exports.deepKeys=function deepKeys(object,prefix){if(typeof prefix==="undefined"){prefix=[]}var keys=[];for(var k in object){if(!Object.hasOwnProperty.call(object,k)){continue}keys.push(prefix.concat([k]));if(typeof object[k]==="object"&&object[k]!==null){keys=keys.concat(deepKeys(object[k],prefix.concat([k])))}}return keys}},{}],5:[function(require,module,exports){var Proto=require("./proto");module.exports=function(tag,data){return Proto.factory(tag,data)};module.exports.proto=Proto;module.exports.augment_prototype=function(api){for(var prop in api){Proto.prototype[prop]=api[prop]}}},{"./proto":6}],6:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var dotty=require("dotty");var util=require("util");var utils=require("digger-utils");function Container(){}function factory(){var models=[];if(typeof arguments[0]==="string"){var string=arguments[0];var c=string.charAt(0);if(c==="{"||c==="["){var data=JSON.parse(string);if(c==="{"){data=[data]}models=data}else{var model=arguments[1]||{};var digger=model._digger||{};digger.tag=string;model._digger=digger;models=[model]}}else if(Object.prototype.toString.call(arguments[0])=="[object Array]"){models=arguments[0]}else if(typeof arguments[0]==="object"){models=[arguments[0]]}if(models[0]===undefined||models[0]===null){models=[]}var instance=function container(){if(!instance.select){throw new Error("there is no select method attached to this container")}var args=[arguments[0]];if(arguments.length>1){args.push(arguments[1])}return instance.select.apply(instance,args)};function process_model(model){}instance.__proto__=Container.prototype;instance.build(models);return instance}Container.factory=factory;util.inherits(Container,EventEmitter);module.exports=Container;Container.prototype.build=function(models){this.models=models||[];function process_model(model){if(!model._digger){model._digger={}}if(!model._digger.diggerid){model._digger.diggerid=utils.diggerid()}if(model._children){model._children.forEach(process_model)}}this.models.forEach(process_model);return this};Container.prototype.toJSON=function(){return this.models};Container.prototype.spawn=function(models){models=models||[];var container=Container.factory(models);if(this.supplychain){container.supplychain=this.supplychain}return container};Container.prototype.clone=function(){var data=JSON.parse(JSON.stringify(this.models));var ret=this.spawn(data);ret.recurse(function(des){var model=des.get(0);var digger=model._digger||{};digger.diggerid=utils.diggerid();model._digger=digger});ret.ensure_parent_ids();return ret};Container.prototype.ensure_parent_ids=function(parent){var self=this;if(parent){this.each(function(c){c.diggerparentid(parent.diggerid())})}this.children().each(function(child){child.ensure_parent_ids(self)})};Container.prototype.inject_paths=function(basepath){this.diggerpath(basepath);this.children().each(function(child,index){child.inject_paths(basepath.concat([index]))})};Container.prototype.ensure_meta=function(done){if(!this.diggerid()){this.diggerid(utils.diggerid())}var topcounter=0;if(this.diggerpath().length<=0){this.inject_paths([topcounter]);topcounter++}this.ensure_parent_ids();return this};Container.prototype.children=function(){var models=[];var self=this;this.each(function(container){models=models.concat(container.get(0)._children||[])});return this.spawn(models)};Container.prototype.recurse=function(fn){this.descendents().each(fn);return this};Container.prototype.descendents=function(){var ret=[];function scoopmodels(container){ret=ret.concat(container.models);container.children().each(scoopmodels)}scoopmodels(this);return this.spawn(ret)};Container.prototype.containers=function(){var self=this;return this.models.map(function(model){var ret=self.spawn([model]);ret["$$hashKey"]=model._digger.diggerid;return ret})};Container.prototype.skeleton=function(){return this.models.map(function(model){return model._digger||{}})};Container.prototype.add=function(container){var self=this;if(!container){return this}if(Object.prototype.toString.call(container)=="[object Array]"){container.forEach(function(c){self.add(c)})}else{this.models=this.models.concat(container.models)}return this};Container.prototype.each=function(fn){this.containers().forEach(fn);return this};Container.prototype.map=function(fn){return this.containers().map(fn)};Container.prototype.count=function(){return this.models.length};Container.prototype.first=function(){return this.eq(0)};Container.prototype.last=function(){return this.eq(this.count()-1)};Container.prototype.eq=function(index){return this.spawn(this.get(index))};Container.prototype.get=function(index){return this.models[index]};function valuereader(model,name){if(!name){return model}return dotty.get(model,name)}function valuesetter(model,value,name){if(!name){return value}dotty.put(model,name,value);return value}function makepath(path,base){var parts=[path];if(base){parts.unshift(base)}return parts.join(".")}function wrapper(basepath){return function(path,val){var self=this;if(arguments.length<=0){if(self.isEmpty()){return null}return valuereader(self.get(0),basepath)}else if(arguments.length===1&&typeof path==="string"){if(self.isEmpty()){return null}return valuereader(self.get(0),makepath(path,basepath))}else if(arguments.length===1){self.models.forEach(function(model){valuesetter(model,val,basepath)});return self}else if(arguments.length>1){var usepath=makepath(path,basepath);self.models.forEach(function(model){valuesetter(model,val,usepath)});return self}}}function property_wrapper(basepath,property){return function(val){var self=this;if(arguments.length<=0){if(self.isEmpty()){return null}var model=dotty.get(self.get(0),basepath);return model[property]}else{if(!self.isEmpty()){self.models.forEach(function(model){var basemodel=dotty.get(model,basepath);basemodel[property]=val})}return self}}}function remove_wrapper(basepath){return function(path){var self=this;var usepath=makepath(path,basepath);self.models.forEach(function(model){dotty.remove(model,usepath)});return self}}Container.prototype.attr=wrapper();Container.prototype.digger=wrapper("_digger");Container.prototype.data=wrapper("_digger.data");Container.prototype.symlink=function(target,selector){var links=this.digger("symlinks")||{};var hasselector=arguments.length>1;if(typeof target==="string"){var url=target+(hasselector?"/"+selector:"");links[url]="symlink"}else{target.each(function(t){var url=t.diggerurl()+(hasselector?"/"+selector:"");links[url]="symlink"})}this.digger("symlinks",links);return this};Container.prototype.diggerid=property_wrapper("_digger","diggerid");Container.prototype.diggerparentid=property_wrapper("_digger","diggerparentid");Container.prototype.diggerwarehouse=property_wrapper("_digger","diggerwarehouse");var pathwrapper=property_wrapper("_digger","diggerpath");Container.prototype.diggerpath=function(){var ret=pathwrapper.apply(this,utils.toArray(arguments));if(!utils.isArray(ret)){ret=[]}return ret};var headerwrapper=property_wrapper("_digger","diggerbranch");Container.prototype.diggerbranch=function(){var ret=branchwrapper.apply(this,utils.toArray(arguments));if(!utils.isArray(ret)){ret=[]}return ret};Container.prototype.addBranch=function(where){var self=this;var branches=this.diggerbranch();where.each(function(container){branches.push(container.diggerurl())});this.diggerbranch(branches);return this};Container.prototype.removeBranch=function(where){var self=this;var branches=this.diggerbranch();where.each(function(container){var newbranches=[];for(var i=0;i<branches.length;i++){if(branches[i]!=container.diggerurl()){newbranches.push(branches[i])}}branches=newbranches});this.diggerbranch(branches);return this};Container.prototype.id=property_wrapper("_digger","id");Container.prototype.tag=property_wrapper("_digger","tag");Container.prototype.classnames=property_wrapper("_digger","class");Container.prototype.removeAttr=remove_wrapper();Container.prototype.removeDigger=remove_wrapper("_digger");Container.prototype.removeData=remove_wrapper("_digger.data");Container.prototype.is=function(tag){return this.tag()==tag};Container.prototype.addClass=function(classname){var self=this;this.models.forEach(function(model){var classnames=model._digger.class||[];var found=false;classnames.forEach(function(c){if(c==classname){found=true}});if(!found){classnames.push(classname)}model._digger.class=classnames});return this};Container.prototype.removeClass=function(classname){var self=this;this.models.forEach(function(model){var classnames=model._digger.class||[];var newclassnames=[];classnames.forEach(function(c){if(c!=classname){newclassnames.push(c)}});model._digger.class=newclassnames});return this};Container.prototype.hasClass=function(classname){var found=false;(this.classnames()||[]).forEach(function(c){if(c==classname){found=true}});return found};Container.prototype.hasAttr=function(name){var prop=this.attr(name);return prop!==null};Container.prototype.isEmpty=function(){return this.count()===0};Container.prototype.inject_data=function(data){this.models.forEach(function(model){utils.extend(model,data)});return this};Container.prototype.diggerurl=function(){var warehouse=this.diggerwarehouse();var id=this.diggerid();var url=warehouse||"/";if(id&&this.tag()!="_supplychain"){if(warehouse!="/"){url+="/"}url+=id}return url.replace(/\/\//g,"/")};Container.prototype.title=function(){var name=this.attr("name");if(!name){name=this.attr("title")}if(!name){name=this.tag()}return name};Container.prototype.summary=function(options){options=options||{};var parts=[];var title=this.attr("name")||this.attr("title")||"";if(title.length>0&&options.title!==false){parts.push(title+": ")}parts.push(this.tag());var id=this.id()||"";if(id.length>0){parts.push("#"+id)}var classnames=this.classnames()||[];if(classnames.length>0){classnames.forEach(function(classname){if(classname.match(/\w/)){parts.push("."+classname.replace(/^\s+/,"").replace(/\s+$/,""))}})}parts.push("="+this.diggerid().substr(0,6)+"...");return parts.join("")};Container.prototype.toString=function(){return this.summary()}},{"digger-utils":3,dotty:4,events:35,util:36}],7:[function(require,module,exports){module.exports=parse;module.exports.mini=miniparse;var chunkers=[{name:"tag",regexp:/^(\*|\w+)/,mapper:function(val,map){map.tag=val}},{name:"class",regexp:/^\.\w+/,mapper:function(val,map){map.class=map.class||{};map.class[val.replace(/^\./,"")]=true}},{name:"id",regexp:/^#\w+/,mapper:function(val,map){map.id=val.replace(/^#/,"")}},{name:"diggerid",regexp:/^=[\w-]+/,mapper:function(val,map){map.diggerid=val.replace(/^=/,"")}},{name:"modifier",regexp:/^:\w+(\(.*?\))?/,mapper:function(val,map){map.modifier=map.modifier||{};var parts=val.split("(");var key=parts[0];val=parts[1];if(val){val=val.replace(/\)$/,"");if(val.match(/^[\d\.-]+$/)){val=JSON.parse(val)}}else{val=true}map.modifier[key.replace(/^:/,"")]=val}},{name:"attr",regexp:/^\[.*?["']?.*?["']?\]/,mapper:function(val,map){map.attr=map.attr||[];var match=val.match(/\[(.*?)([=><\^\|\*\~\$\!]+)["']?(.*?)["']?\]/);if(match){map.attr.push({field:match[1],operator:match[2],value:match[3]})}else{map.attr.push({field:val.replace(/^\[/,"").replace(/\]$/,"")})}}},{name:"splitter",regexp:/^[ ,<>]+/,mapper:function(val,map){map.splitter=val.replace(/\s+/g,"")}}];function parseChunks(selector){var lastMatch=null;var workingString=selector?selector:"";var lastString="";var chunks=[];var matchNextChunk=function(){lastMatch=null;for(var i in chunkers){var chunker=chunkers[i];if(lastMatch=workingString.match(chunker.regexp)){var data={value:lastMatch[0]};for(prop in chunker){data[prop]=chunker[prop]}data.string=lastMatch[0];chunks.push(data);workingString=workingString.replace(lastMatch[0],"");return true}}return false};while(matchNextChunk()){if(lastString==workingString){break}}return chunks}function new_selector(){return{string:"","class":{},attr:[],modifier:{}}}function parse(selector_string){if(typeof selector_string!="string"){return selector_string}var chunks=parseChunks(selector_string);var phases=[];var currentPhase=[];var currentSelector=new_selector();var addCurrentPhase=function(){if(currentPhase.length>0){phases.push(currentPhase)}currentPhase=[]};var addCurrentSelector=function(){if(Object.keys(currentSelector).length>0){currentPhase.push(currentSelector)}currentSelector=new_selector()};var addChunkToSelector=function(chunk,selector){chunk.mapper.apply(null,[chunk.value,selector]);selector.string+=chunk.string};chunks.forEach(function(chunk,index){if(chunk.name=="splitter"&&chunk.value.match(/,/)){addCurrentSelector();addCurrentPhase()}else{if(chunk.name=="splitter"&&index>0){addCurrentSelector()}addChunkToSelector(chunk,currentSelector)}});addCurrentSelector();addCurrentPhase();return{string:selector_string,phases:phases}}function miniparse(selector_string){if(typeof selector_string!=="string"){return selector_string}selector_string=selector_string||"";var selector={"class":{},modifier:{}};selector_string=selector_string.replace(/_(\w+)/,function(match,id){selector.id=id;return""});selector_string=selector_string.replace(/\.(\w+)/g,function(match,classname){selector.class[classname]=true;return""});if(selector_string.match(/\d/)){selector.diggerid=selector_string}else{selector.tag=selector_string}return selector}},{}],8:[function(require,module,exports){module.exports=require(1)},{}],9:[function(require,module,exports){module.exports=require(2)},{}],10:[function(require,module,exports){var extend=require("extend");var hat=require("hat");var utils=module.exports={};utils.diggerid=function(){return hat()};utils.littleid=function(chars){chars=chars||6;var pattern="";for(var i=0;i<chars;i++){pattern+="x"}return pattern.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};utils.escapeRegexp=function(search){return search.replace(/([\!\$\(\)\*\+\.\/\:\=\?\[\\\]\^\{\|\}])/g,"\\$1")};utils.json_request=function(req){return{method:req.method.toLowerCase(),url:req.url,body:req.body,headers:req.headers}};utils.isArray=function(arr){return Object.prototype.toString.call(arr)=="[object Array]"};utils.toArray=function(args){return Array.prototype.slice.call(args,0)};utils.parse_request=function(method,url){};utils.export_user=function(user){var ret={};for(var prop in user){if(prop.charAt(0)!="_"){ret[prop]=user[prop]}}return ret};utils.extend=extend},{extend:8,hat:9}],11:[function(require,module,exports){var Selector=require("digger-selector");var utils=require("digger-utils");module.exports={select:select,append:append,save:save,remove:remove};function multiple_branch(list,wrapper){if(list.length<=1){return list[0]}else{wrapper.body=list;return wrapper}}function select(selector_string,context_string){var self=this;if(this.count()<=0){throw new Error("attempting a select on an empty container")}var strings=[selector_string];if(arguments.length>1){strings.push(context_string)}var selectors=strings.map(function(selector){return Selector(selector)});var context=this.containers();var groups={};this.each(function(container){var warehouse=container.diggerwarehouse()||"/";var arr=groups[warehouse]||[];arr.push(container);groups[warehouse]=arr});var warehouseurls=Object.keys(groups);var topcontract={};function basic_contract(type){return{method:"post",url:"/reception",headers:{"Content-Type":"application/json","x-contract-type":type,"x-contract-id":utils.diggerid()}}}function create_warehouse_pipe_contract(warehouseurl){var skeleton=groups[warehouseurl].map(function(c){return c.get(0)._digger}).filter(function(digger){return digger.tag!="_supplychain"});var phase_contracts=selectors.reverse().map(function(selector_phase){var selector_contracts=selector_phase.phases.map(function(selector_stages){var last_selector=selector_stages[selector_stages.length-1];var modifier=last_selector.modifier||{};modifier.laststep=true;last_selector.modifier=modifier;var selector_requests=selector_stages.map(function(selector){return{method:"post",url:(warehouseurl+"/select").replace(/\/\//g,"/"),headers:{"Content-Type":"application/json","x-json-selector":selector}}});selector_requests[0].body=skeleton;return multiple_branch(selector_requests,basic_contract("pipe"))});return multiple_branch(selector_contracts,basic_contract("merge"))});return multiple_branch(phase_contracts,basic_contract("pipe"))}var warehouse_pipe_contracts=warehouseurls.map(create_warehouse_pipe_contract);var topcontract=multiple_branch(warehouse_pipe_contracts,{method:"post",url:"/reception",headers:{"Content-Type":"application/json","x-contract-type":"merge","x-contract-id":utils.diggerid()}});return this.supplychain?this.supplychain.contract(topcontract,self).expect("containers"):topcontract}function append(appendcontainer){var self=this;if(arguments.length<=0||appendcontainer.count()<=0){throw new Error("there is nothing to append")}if(this.count()<=0){throw new Error("there is nothing to append to")}var appendmodels=appendcontainer.models;var appendto=this.eq(0);var appendtomodel=this.get(0);appendtomodel._children=(appendtomodel._children||[]).concat(appendmodels);var raw={method:"post",headers:{"Content-Type":"application/json","x-contract-type":"merge","x-contract-id":utils.diggerid()},url:"/reception",body:[{method:"post",headers:{"Content-Type":"application/json","x-contract-id":utils.diggerid()},url:appendto.diggerurl(),body:appendmodels}]};appendcontainer.supplychain=this.supplychain;return this.supplychain?this.supplychain.contract(raw,self).after(function(results){var map={};appendmodels.forEach(function(model){map[model._digger.diggerid]=model});results.forEach(function(result){var model=map[result._digger.diggerid];if(model){for(var prop in result){model[prop]=result[prop]}}});return self.spawn(results)}):raw}function save(){var self=this;if(this.count()<=0){throw new Error("there is nothing to save")}var raw={method:"post",headers:{"Content-Type":"application/json","x-contract-type":"merge","x-contract-id":utils.diggerid()},url:"/reception",body:this.map(function(container){var model=container.get(0);var savemodel=JSON.parse(JSON.stringify(model));delete savemodel._children;delete savemodel._digger.data;return{method:"put",headers:{"Content-Type":"application/json","x-contract-id":utils.diggerid()},url:container.diggerurl(),body:savemodel}})};return this.supplychain?this.supplychain.contract(raw,self):raw}function remove(){var self=this;if(this.count()<=0){throw new Error("there is nothing to delete")}var raw={method:"post",url:"/reception",headers:{"Content-Type":"application/json","x-contract-type":"merge","x-contract-id":utils.diggerid()},body:this.map(function(container){return{method:"delete",headers:{"Content-Type":"application/json","x-contract-id":utils.diggerid()},url:container.diggerurl()}})};return this.supplychain?this.supplychain.contract(raw,self):raw}},{"digger-selector":7,"digger-utils":10}],12:[function(require,module,exports){module.exports=factory;function State(arr){this.count=arr.length;this.index=0;this.finished=false}State.prototype.next=function(){this.index++;if(this.index>=this.count){this.finished=true}};function factory(searchfn){return function(selectors,context){var final_state=new State(selectors);var final_results=context.spawn();selectors.reverse().forEach(function(stage){final_state.next();var stage_results=context.spawn();stage.phases.forEach(function(phase){var phase_context=context;var selector_state=new State(phase);var cancel=false;phase.forEach(function(selector){if(cancel){return}selector_state.next();var results=searchfn(selector,phase_context);if(results.count()<=0){cancel=true;return false}if(!selector_state.finished){phase_context=results}else{stage_results.add(results)}return true})});if(stage_results.count()<=0){return false}if(!final_state.finished){context=stage_results}else{final_results=stage_results}});return final_results}}},{}],13:[function(require,module,exports){var find=require("./find");var search=require("./search");var Selector=require("digger-selector");var finder=find(search.searcher);var sortfns={title:function(a,b){if(a.title().toLowerCase()<b.title().toLowerCase())return-1;if(a.title().toLowerCase()>b.title().toLowerCase())return 1;return 0},field:function(name){return function(a,b){if(a.attr(name).toLowerCase()<b.attr(name).toLowerCase())return-1;if(a.attr(name).toLowerCase()>b.attr(name).toLowerCase())return 1;return 0}}};module.exports={find:function(selector,context){var selectors=[selector];if(context){selectors.push(context)}selectors=selectors.map(function(string){return Selector(string)});return finder(selectors,this)},sort:function(fn){if(typeof fn==="string"){fn=sortfns.field(fn)}else if(!fn){fn=sortfns.title}this.each(function(container){var newchildren=container.children().containers().sort(fn);var model=container.get(0);model.children=newchildren.map(function(container){return container.get(0)})});return this},filter:function(filterfn){if(!typeof filterfn=="function"){if(typeof filterfn=="string"){filterfn=Selector(filterfn).phases[0][0]}filterfn=search.compiler(filterfn)}var matching_container_array=this.containers().filter(filterfn);return this.spawn(matching_container_array.map(function(container){return container.get(0)}))},match:function(selector){if(this.count()<=0){return false}var results=this.filter(selector);return results.count()>0}}},{"./find":12,"./search":14,"digger-selector":15}],14:[function(require,module,exports){var utils=require("digger-utils");module.exports.searcher=search;module.exports.compiler=compile;var attr_compare_functions={"=":function(check,target){return check!=null&&check==target},"!=":function(check,target){return check!=null&&check!=target},">":function(check,target){target=parseFloat(target);return check!=null&&!isNaN(target)?check>target:false},">=":function(check,target){target=parseFloat(target);return check!=null&&!isNaN(target)?check>=target:false},"<":function(check,target){target=parseFloat(target);return check!=null&&!isNaN(target)?check<target:false},"<=":function(check,target){target=parseFloat(target);return check!=null&&!isNaN(target)?check<=target:false},"^=":function(check,target){return check!=null&&check.match(new RegExp("^"+utils.escapeRegexp(target),"i"))!==null},"$=":function(check,target){return check!=null&&check.match(new RegExp(utils.escapeRegexp(target)+"$","i"))!==null},"~=":function(check,target){return check!=null&&check.match(new RegExp("\\W"+utils.escapeRegexp(target)+"\\W","i"))!==null},"|=":function(check,target){return check!=null&&check.match(new RegExp("^"+utils.escapeRegexp(target)+"-","i"))!==null},"*=":function(check,target){return check!=null&&check.match(new RegExp(utils.escapeRegexp(target),"i"))!==null}};function compile(selector){return function(container){var model=container.get(0);var digger=model._digger;function notfilter(val){if(!val){val=false}return selector.modifier&&selector.modifier.not?!val:val}function notcountfilter(number){var orig=number||0;var opposite=orig==0?1:0;return selector.modifier&&selector.modifier.not?opposite:orig}if(selector.tag=="*"){return notfilter(true)}if(selector.id&&notfilter(digger.id!=selector.id)){return false}if(selector.diggerid&&notfilter(digger.diggerid!=selector.diggerid)){return false}if(selector.tag&&notfilter(digger.tag!=selector.tag)){return false}if(selector.class){var keys=Object.keys(selector.class||{});var classcount=0;keys.forEach(function(c){classcount+=container.hasClass(c)?notcountfilter(1):notcountfilter(0)});if(classcount<keys.length){return false}}if(selector.attr){var attr_count=0;selector.attr.forEach(function(attr_filter){var check_value=container.attr(attr_filter.field);var operator_function=attr_compare_functions[attr_filter.operator];if(!attr_filter.value){attr_count+=check_value!==null?notcountfilter(1):notcountfilter(0)}else if(operator_function){attr_count+=operator_function.apply(null,[check_value,attr_filter.value])?notcountfilter(1):notcountfilter(0)}});if(attr_count<selector.attr.length){return false}}return true}}function search(selector,context){var selector_filter=compile(selector);var search_in=context;if(selector.splitter==">"){search_in=context.children()}else if(selector.splitter=="<"){throw new Error("we do not support the parent splitter at the moment")}else{search_in=context.descendents()}var ret=search_in.filter(selector_filter);var modifier=selector.modifier||{};if(modifier.limit){var st=""+modifier.limit;if(st.indexOf(",")>=0){var parts=st.split(",").map(function(stt){return stt.replace(/\D/g,"")});ret.models=ret.models.slice(parts[0],parts[1])}else{ret.models=ret.models.slice(0,modifier.limit)}}if(modifier.first&&ret.models.length>0){ret.models=[ret.models[0]]}else if(modifier.last&&ret.models.length>0){ret.models=[ret.models[ret.models.length-1]]}return ret}},{"digger-utils":25}],15:[function(require,module,exports){module.exports=require(7)},{}],16:[function(require,module,exports){module.exports=require(4)},{}],17:[function(require,module,exports){arguments[4][5][0].apply(exports,arguments)},{"./proto":18}],18:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var dotty=require("dotty");var util=require("util");var utils=require("digger-utils");function Container(){}function factory(){var models=[];if(typeof arguments[0]==="string"){var string=arguments[0];var c=string.charAt(0);if(c==="{"||c==="["){var data=JSON.parse(string);if(c==="{"){data=[data]}models=data}else{var model=arguments[1]||{};var digger=model._digger||{};digger.tag=string;model._digger=digger;models=[model]}}else if(Object.prototype.toString.call(arguments[0])=="[object Array]"){models=arguments[0]}else if(typeof arguments[0]==="object"){models=[arguments[0]]}if(models[0]===undefined||models[0]===null){models=[]}var instance=function container(){if(!instance.select){throw new Error("there is no select method attached to this container")}var args=[arguments[0]];if(arguments.length>1){args.push(arguments[1])}return instance.select.apply(instance,args)};instance.__proto__=new Container;instance.build(models);return instance}Container.factory=factory;util.inherits(Container,EventEmitter);module.exports=Container;Container.prototype.build=function(models){this.models=models||[];for(var i in models){var model=models[i];
if(!model._digger){model._digger={}}if(!model._digger.diggerid){model._digger.diggerid=utils.diggerid()}}return this};Container.prototype.toJSON=function(){return this.models};Container.prototype.spawn=function(models){models=models||[];var container=Container.factory(models);if(this.supplychain){container.supplychain=this.supplychain}return container};Container.prototype.clone=function(){var data=JSON.parse(JSON.stringify(this.models));var ret=this.spawn(data);ret.recurse(function(des){var model=des.get(0);var digger=model._digger||{};digger.diggerid=utils.diggerid();model._digger=digger});ret.ensure_parent_ids();return ret};Container.prototype.ensure_parent_ids=function(parent){var self=this;if(parent){this.each(function(c){c.diggerparentid(parent.diggerid())})}this.children().each(function(child){child.ensure_parent_ids(self)})};Container.prototype.inject_paths=function(basepath){this.diggerpath(basepath);this.children().each(function(child,index){child.inject_paths(basepath.concat([index]))})};Container.prototype.ensure_meta=function(done){if(!this.diggerid()){this.diggerid(utils.diggerid())}var topcounter=0;if(this.diggerpath().length<=0){this.inject_paths([topcounter]);topcounter++}this.ensure_parent_ids();return this};Container.prototype.children=function(){var models=[];var self=this;this.each(function(container){models=models.concat(container.get(0)._children||[])});return this.spawn(models)};Container.prototype.recurse=function(fn){this.descendents().each(fn);return this};Container.prototype.descendents=function(){var ret=[];function scoopmodels(container){ret=ret.concat(container.models);container.children().each(scoopmodels)}scoopmodels(this);return this.spawn(ret)};Container.prototype.containers=function(){var self=this;return this.models.map(function(model){return self.spawn([model])})};Container.prototype.skeleton=function(){return this.models.map(function(model){return model._digger||{}})};Container.prototype.add=function(container){var self=this;if(!container){return this}if(Object.prototype.toString.call(container)=="[object Array]"){container.forEach(function(c){self.add(c)})}else{this.models=this.models.concat(container.models)}return this};Container.prototype.each=function(fn){this.containers().forEach(fn);return this};Container.prototype.map=function(fn){return this.containers().map(fn)};Container.prototype.count=function(){return this.models.length};Container.prototype.first=function(){return this.eq(0)};Container.prototype.last=function(){return this.eq(this.count()-1)};Container.prototype.eq=function(index){return this.spawn(this.get(index))};Container.prototype.get=function(index){return this.models[index]};function valuereader(model,name){if(!name){return model}return dotty.get(model,name)}function valuesetter(model,value,name){if(!name){return value}dotty.put(model,name,value);return value}function makepath(path,base){var parts=[path];if(base){parts.unshift(base)}return parts.join(".")}function wrapper(basepath){return function(path,val){var self=this;if(arguments.length<=0){if(self.isEmpty()){return null}return valuereader(self.get(0),basepath)}else if(arguments.length===1&&typeof path==="string"){if(self.isEmpty()){return null}return valuereader(self.get(0),makepath(path,basepath))}else if(arguments.length===1){self.models.forEach(function(model){valuesetter(model,val,basepath)});return self}else if(arguments.length>1){var usepath=makepath(path,basepath);self.models.forEach(function(model){valuesetter(model,val,usepath)});return self}}}function property_wrapper(basepath,property){return function(val){var self=this;if(arguments.length<=0){if(self.isEmpty()){return null}var model=dotty.get(self.get(0),basepath);return model[property]}else{if(!self.isEmpty()){self.models.forEach(function(model){var basemodel=dotty.get(model,basepath);basemodel[property]=val})}return self}}}function remove_wrapper(basepath){return function(path){var self=this;var usepath=makepath(path,basepath);self.models.forEach(function(model){dotty.remove(model,usepath)});return self}}Container.prototype.attr=wrapper();Container.prototype.digger=wrapper("_digger");Container.prototype.data=wrapper("_digger.data");Container.prototype.diggerid=property_wrapper("_digger","diggerid");Container.prototype.diggerparentid=property_wrapper("_digger","diggerparentid");Container.prototype.diggerwarehouse=property_wrapper("_digger","diggerwarehouse");var pathwrapper=property_wrapper("_digger","diggerpath");Container.prototype.diggerpath=function(){var ret=pathwrapper.apply(this,utils.toArray(arguments));if(!utils.isArray(ret)){ret=[]}return ret};var branchwrapper=property_wrapper("_digger","diggerbranch");Container.prototype.diggerbranch=function(){var ret=branchwrapper.apply(this,utils.toArray(arguments));if(!utils.isArray(ret)){ret=[]}return ret};Container.prototype.addBranch=function(where){var self=this;var branches=this.diggerbranch();where.each(function(container){branches.push(container.diggerurl())});this.diggerbranch(branches);return this};Container.prototype.removeBranch=function(where){var self=this;var branches=this.diggerbranch();where.each(function(container){var newbranches=[];for(var i=0;i<branches.length;i++){if(branches[i]!=container.diggerurl()){newbranches.push(branches[i])}}branches=newbranches});this.diggerbranch(branches);return this};Container.prototype.id=property_wrapper("_digger","id");Container.prototype.tag=property_wrapper("_digger","tag");Container.prototype.classnames=property_wrapper("_digger","class");Container.prototype.removeAttr=remove_wrapper();Container.prototype.removeDigger=remove_wrapper("_digger");Container.prototype.removeData=remove_wrapper("_digger.data");Container.prototype.is=function(tag){return this.tag()==tag};Container.prototype.addClass=function(classname){var self=this;this.models.forEach(function(model){var classnames=model._digger.class||[];var found=false;classnames.forEach(function(c){if(c==classname){found=true}});if(!found){classnames.push(classname)}model._digger.class=classnames});return this};Container.prototype.removeClass=function(classname){var self=this;this.models.forEach(function(model){var classnames=model._digger.class||[];var newclassnames=[];classnames.forEach(function(c){if(c!=classname){newclassnames.push(c)}});model._digger.class=newclassnames});return this};Container.prototype.hasClass=function(classname){var found=false;(this.classnames()||[]).forEach(function(c){if(c==classname){found=true}});return found};Container.prototype.hasAttr=function(name){var prop=this.attr(name);return prop!==null};Container.prototype.isEmpty=function(){return this.count()===0};Container.prototype.inject_data=function(data){this.models.forEach(function(model){utils.extend(model,data)});return this};Container.prototype.diggerurl=function(){var warehouse=this.diggerwarehouse();var id=this.diggerid();var url=warehouse||"/";if(id&&this.tag()!="_supplychain"){if(warehouse!="/"){url+="/"}url+=id}return url.replace(/\/\//g,"/")};Container.prototype.title=function(){var name=this.attr("name");if(!name){name=this.attr("title")}if(!name){name=this.tag()}return name};Container.prototype.summary=function(options){options=options||{};var parts=[];var title=this.attr("name")||this.attr("title")||"";if(title.length>0&&options.title!==false){parts.push(title+": ")}parts.push(this.tag());var id=this.id()||"";if(id.length>0){parts.push("#"+id)}var classnames=this.classnames()||[];if(classnames.length>0){classnames.forEach(function(classname){if(classname.match(/\w/)){parts.push("."+classname.replace(/^\s+/,"").replace(/\s+$/,""))}})}return parts.join("")};Container.prototype.toString=function(){return this.summary()}},{"digger-utils":21,dotty:16,events:35,util:36}],19:[function(require,module,exports){module.exports=require(1)},{}],20:[function(require,module,exports){module.exports=require(2)},{}],21:[function(require,module,exports){module.exports=require(3)},{extend:19,hat:20}],22:[function(require,module,exports){var process=require("__browserify_process");var Container=require("digger-container");var EventEmitter=require("events").EventEmitter;var util=require("util");var utils=require("digger-utils");module.exports=factory;function factory(handle,use_container){var supplychain=new SupplyChain(handle,use_container);return supplychain}function SupplyChain(handle,use_container){this.handle=handle;this.container=use_container||Container;this.create=use_container||Container}util.inherits(SupplyChain,EventEmitter);SupplyChain.prototype.contract=function(req,container){var self=this;if(!req.headers){req.headers={}}function trigger_request(callback){if(!self.handle||typeof self.handle!="function"){setTimeout(function(){loadresults.reject("There is no handle method attached to this supplychain")},0)}else{self.handle({method:req.method,url:req.url,headers:req.headers,body:req.body},function(error,result){if(error){callback(error);return}else{if(!result){result=[]}if(!utils.isArray(result)&&typeof result==="object"){if(result.headers){result=result.body}result=[result]}if(req.results_processor){result=req.results_processor(result)}callback(null,result)}})}}req.ship=function(fn){process.nextTick(function(){trigger_request(function(error,answer){if(error){if(req._fail){req._fail(error)}else{console.log("a request has an error but the contract has no fail handler");console.dir(req.method+" "+req.url);console.log(error)}}else{fn(answer);if(req._after){req._after(answer)}}})});return this};req.fail=function(fn){req._fail=fn;return this};req.expect=function(type){if(type=="containers"){req.results_processor=function(results){return container.spawn(results)}}return this};req.after=function(fn){req._after=fn;return this};req.debug=function(){req.headers["x-debug"]=true;return this};return req};SupplyChain.prototype.connect=function(diggerwarehouse,diggerid){var self=this;var container=self.container(arguments.length>1?"item":"_supplychain");container.diggerwarehouse(diggerwarehouse||"/");if(arguments.length>1){container.diggerid(diggerid)}container.supplychain=this;return container};SupplyChain.prototype.contract_group=function(type,contracts){var raw={method:"post",url:"/reception",headers:{"content-type":"digger/contract","x-contract-type":type},body:contracts||[]};var stub=self.container();stub.supplychain=this;return this.contract(raw,stub)};SupplyChain.prototype.merge=function(contracts){return this.contract_group("merge",contracts)};SupplyChain.prototype.pipe=function(contracts){return this.contract_group("pipe",contracts)}},{__browserify_process:37,"digger-container":17,"digger-utils":21,events:35,util:36}],23:[function(require,module,exports){module.exports=require(1)},{}],24:[function(require,module,exports){module.exports=require(2)},{}],25:[function(require,module,exports){var extend=require("extend");var hat=require("hat");var utils=module.exports={};utils.diggerid=function(){return hat()};utils.littleid=function(chars){chars=chars||6;var pattern="";for(var i=0;i<chars;i++){pattern+="x"}return pattern.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};utils.isdiggerid=function(id){return id&&id.match(/^\w{32}$/)?true:false};utils.escapeRegexp=function(search){return search.replace(/([\!\$\(\)\*\+\.\/\:\=\?\[\\\]\^\{\|\}])/g,"\\$1")};utils.json_request=function(req){return{method:req.method.toLowerCase(),url:req.url,body:req.body,headers:req.headers}};utils.isArray=function(arr){return Object.prototype.toString.call(arr)=="[object Array]"};utils.toArray=function(args){return Array.prototype.slice.call(args,0)};utils.parse_request=function(method,url){};utils.export_user=function(user){var ret={};for(var prop in user){if(prop.charAt(0)!="_"){ret[prop]=user[prop]}}return ret};utils.extend=extend},{extend:23,hat:24}],26:[function(require,module,exports){var SupplyChain=require("digger-supplychain");var Container=require("digger-container");Container.augment_prototype(require("digger-contracts"));Container.augment_prototype(require("digger-find"));module.exports=function(handle){var supplychain=SupplyChain(handle,Container);return supplychain};module.exports.Container=Container},{"digger-container":5,"digger-contracts":11,"digger-find":13,"digger-supplychain":22}],27:[function(require,module,exports){module.exports=require(1)},{}],28:[function(require,module,exports){module.exports=require(2)},{}],29:[function(require,module,exports){module.exports=require(10)},{extend:27,hat:28}],30:[function(require,module,exports){var io="undefined"===typeof module?{}:module.exports;(function(){(function(exports,global){var io=exports;io.version="0.9.16";io.protocol=1;io.transports=[];io.j=[];io.sockets={};io.connect=function(host,details){var uri=io.util.parseUri(host),uuri,socket;if(global&&global.location){uri.protocol=uri.protocol||global.location.protocol.slice(0,-1);uri.host=uri.host||(global.document?global.document.domain:global.location.hostname);uri.port=uri.port||global.location.port}uuri=io.util.uniqueUri(uri);var options={host:uri.host,secure:"https"==uri.protocol,port:uri.port||("https"==uri.protocol?443:80),query:uri.query||""};io.util.merge(options,details);if(options["force new connection"]||!io.sockets[uuri]){socket=new io.Socket(options)}if(!options["force new connection"]&&socket){io.sockets[uuri]=socket}socket=socket||io.sockets[uuri];return socket.of(uri.path.length>1?uri.path:"")}})("object"===typeof module?module.exports:this.io={},this);(function(exports,global){var util=exports.util={};var re=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];util.parseUri=function(str){var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}return uri};util.uniqueUri=function(uri){var protocol=uri.protocol,host=uri.host,port=uri.port;if("document"in global){host=host||document.domain;port=port||(protocol=="https"&&document.location.protocol!=="https:"?443:document.location.port)}else{host=host||"localhost";if(!port&&protocol=="https"){port=443}}return(protocol||"http")+"://"+host+":"+(port||80)};util.query=function(base,addition){var query=util.chunkQuery(base||""),components=[];util.merge(query,util.chunkQuery(addition||""));for(var part in query){if(query.hasOwnProperty(part)){components.push(part+"="+query[part])}}return components.length?"?"+components.join("&"):""};util.chunkQuery=function(qs){var query={},params=qs.split("&"),i=0,l=params.length,kv;for(;i<l;++i){kv=params[i].split("=");if(kv[0]){query[kv[0]]=kv[1]}}return query};var pageLoaded=false;util.load=function(fn){if("document"in global&&document.readyState==="complete"||pageLoaded){return fn()}util.on(global,"load",fn,false)};util.on=function(element,event,fn,capture){if(element.attachEvent){element.attachEvent("on"+event,fn)}else if(element.addEventListener){element.addEventListener(event,fn,capture)}};util.request=function(xdomain){if(xdomain&&"undefined"!=typeof XDomainRequest&&!util.ua.hasCORS){return new XDomainRequest}if("undefined"!=typeof XMLHttpRequest&&(!xdomain||util.ua.hasCORS)){return new XMLHttpRequest}if(!xdomain){try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}return null};if("undefined"!=typeof window){util.load(function(){pageLoaded=true})}util.defer=function(fn){if(!util.ua.webkit||"undefined"!=typeof importScripts){return fn()}util.load(function(){setTimeout(fn,100)})};util.merge=function merge(target,additional,deep,lastseen){var seen=lastseen||[],depth=typeof deep=="undefined"?2:deep,prop;for(prop in additional){if(additional.hasOwnProperty(prop)&&util.indexOf(seen,prop)<0){if(typeof target[prop]!=="object"||!depth){target[prop]=additional[prop];seen.push(additional[prop])}else{util.merge(target[prop],additional[prop],depth-1,seen)}}}return target};util.mixin=function(ctor,ctor2){util.merge(ctor.prototype,ctor2.prototype)};util.inherit=function(ctor,ctor2){function f(){}f.prototype=ctor2.prototype;ctor.prototype=new f};util.isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};util.intersect=function(arr,arr2){var ret=[],longest=arr.length>arr2.length?arr:arr2,shortest=arr.length>arr2.length?arr2:arr;for(var i=0,l=shortest.length;i<l;i++){if(~util.indexOf(longest,shortest[i]))ret.push(shortest[i])}return ret};util.indexOf=function(arr,o,i){for(var j=arr.length,i=i<0?i+j<0?0:i+j:i||0;i<j&&arr[i]!==o;i++){}return j<=i?-1:i};util.toArray=function(enu){var arr=[];for(var i=0,l=enu.length;i<l;i++)arr.push(enu[i]);return arr};util.ua={};util.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(e){return false}return a.withCredentials!=undefined}();util.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);util.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)})("undefined"!=typeof io?io:module.exports,this);(function(exports,io){exports.EventEmitter=EventEmitter;function EventEmitter(){}EventEmitter.prototype.on=function(name,fn){if(!this.$events){this.$events={}}if(!this.$events[name]){this.$events[name]=fn}else if(io.util.isArray(this.$events[name])){this.$events[name].push(fn)}else{this.$events[name]=[this.$events[name],fn]}return this};EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.once=function(name,fn){var self=this;function on(){self.removeListener(name,on);fn.apply(this,arguments)}on.listener=fn;this.on(name,on);return this};EventEmitter.prototype.removeListener=function(name,fn){if(this.$events&&this.$events[name]){var list=this.$events[name];if(io.util.isArray(list)){var pos=-1;for(var i=0,l=list.length;i<l;i++){if(list[i]===fn||list[i].listener&&list[i].listener===fn){pos=i;break}}if(pos<0){return this}list.splice(pos,1);if(!list.length){delete this.$events[name]}}else if(list===fn||list.listener&&list.listener===fn){delete this.$events[name]}}return this};EventEmitter.prototype.removeAllListeners=function(name){if(name===undefined){this.$events={};return this}if(this.$events&&this.$events[name]){this.$events[name]=null}return this};EventEmitter.prototype.listeners=function(name){if(!this.$events){this.$events={}}if(!this.$events[name]){this.$events[name]=[]}if(!io.util.isArray(this.$events[name])){this.$events[name]=[this.$events[name]]}return this.$events[name]};EventEmitter.prototype.emit=function(name){if(!this.$events){return false}var handler=this.$events[name];if(!handler){return false}var args=Array.prototype.slice.call(arguments,1);if("function"==typeof handler){handler.apply(this,args)}else if(io.util.isArray(handler)){var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}}else{return false}return true}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,nativeJSON){"use strict";if(nativeJSON&&nativeJSON.parse){return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify}}var JSON=exports.JSON={};function f(n){return n<10?"0"+n:n}function date(d,key){return isFinite(d.valueOf())?d.getUTCFullYear()+"-"+f(d.getUTCMonth()+1)+"-"+f(d.getUTCDate())+"T"+f(d.getUTCHours())+":"+f(d.getUTCMinutes())+":"+f(d.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value instanceof Date){value=date(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})};JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}})("undefined"!=typeof io?io:module.exports,typeof JSON!=="undefined"?JSON:undefined);(function(exports,io){var parser=exports.parser={};var packets=parser.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"];var reasons=parser.reasons=["transport not supported","client not handshaken","unauthorized"];var advice=parser.advice=["reconnect"];var JSON=io.JSON,indexOf=io.util.indexOf;parser.encodePacket=function(packet){var type=indexOf(packets,packet.type),id=packet.id||"",endpoint=packet.endpoint||"",ack=packet.ack,data=null;switch(packet.type){case"error":var reason=packet.reason?indexOf(reasons,packet.reason):"",adv=packet.advice?indexOf(advice,packet.advice):"";if(reason!==""||adv!=="")data=reason+(adv!==""?"+"+adv:"");break;case"message":if(packet.data!=="")data=packet.data;break;case"event":var ev={name:packet.name};if(packet.args&&packet.args.length){ev.args=packet.args}data=JSON.stringify(ev);break;case"json":data=JSON.stringify(packet.data);break;case"connect":if(packet.qs)data=packet.qs;break;case"ack":data=packet.ackId+(packet.args&&packet.args.length?"+"+JSON.stringify(packet.args):"");break}var encoded=[type,id+(ack=="data"?"+":""),endpoint];if(data!==null&&data!==undefined)encoded.push(data);return encoded.join(":")};parser.encodePayload=function(packets){var decoded="";if(packets.length==1)return packets[0];for(var i=0,l=packets.length;i<l;i++){var packet=packets[i];decoded+="�"+packet.length+"�"+packets[i]}return decoded};var regexp=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;parser.decodePacket=function(data){var pieces=data.match(regexp);if(!pieces)return{};var id=pieces[2]||"",data=pieces[5]||"",packet={type:packets[pieces[1]],endpoint:pieces[4]||""};if(id){packet.id=id;if(pieces[3])packet.ack="data";else packet.ack=true}switch(packet.type){case"error":var pieces=data.split("+");packet.reason=reasons[pieces[0]]||"";packet.advice=advice[pieces[1]]||"";break;case"message":packet.data=data||"";break;case"event":try{var opts=JSON.parse(data);packet.name=opts.name;packet.args=opts.args}catch(e){}packet.args=packet.args||[];break;case"json":try{packet.data=JSON.parse(data)}catch(e){}break;case"connect":packet.qs=data||"";break;case"ack":var pieces=data.match(/^([0-9]+)(\+)?(.*)/);if(pieces){packet.ackId=pieces[1];packet.args=[];if(pieces[3]){try{packet.args=pieces[3]?JSON.parse(pieces[3]):[]}catch(e){}}}break;case"disconnect":case"heartbeat":break}return packet};parser.decodePayload=function(data){if(data.charAt(0)=="�"){var ret=[];for(var i=1,length="";i<data.length;i++){if(data.charAt(i)=="�"){ret.push(parser.decodePacket(data.substr(i+1).substr(0,length)));i+=Number(length)+1;length=""}else{length+=data.charAt(i)}}return ret}else{return[parser.decodePacket(data)]}}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io){exports.Transport=Transport;function Transport(socket,sessid){this.socket=socket;this.sessid=sessid}io.util.mixin(Transport,io.EventEmitter);Transport.prototype.heartbeats=function(){return true};Transport.prototype.onData=function(data){this.clearCloseTimeout();if(this.socket.connected||this.socket.connecting||this.socket.reconnecting){this.setCloseTimeout()}if(data!==""){var msgs=io.parser.decodePayload(data);if(msgs&&msgs.length){for(var i=0,l=msgs.length;i<l;i++){this.onPacket(msgs[i])}}}return this};Transport.prototype.onPacket=function(packet){this.socket.setHeartbeatTimeout();if(packet.type=="heartbeat"){return this.onHeartbeat()}if(packet.type=="connect"&&packet.endpoint==""){this.onConnect()}if(packet.type=="error"&&packet.advice=="reconnect"){this.isOpen=false}this.socket.onPacket(packet);return this};Transport.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var self=this;this.closeTimeout=setTimeout(function(){self.onDisconnect()},this.socket.closeTimeout)}};Transport.prototype.onDisconnect=function(){if(this.isOpen)this.close();this.clearTimeouts();this.socket.onDisconnect();return this};Transport.prototype.onConnect=function(){this.socket.onConnect();return this};Transport.prototype.clearCloseTimeout=function(){if(this.closeTimeout){clearTimeout(this.closeTimeout);this.closeTimeout=null}};Transport.prototype.clearTimeouts=function(){this.clearCloseTimeout();if(this.reopenTimeout){clearTimeout(this.reopenTimeout)}};Transport.prototype.packet=function(packet){this.send(io.parser.encodePacket(packet))};Transport.prototype.onHeartbeat=function(heartbeat){this.packet({type:"heartbeat"})};Transport.prototype.onOpen=function(){this.isOpen=true;this.clearCloseTimeout();this.socket.onOpen()};Transport.prototype.onClose=function(){var self=this;this.isOpen=false;this.socket.onClose();this.onDisconnect()};Transport.prototype.prepareUrl=function(){var options=this.socket.options;return this.scheme()+"://"+options.host+":"+options.port+"/"+options.resource+"/"+io.protocol+"/"+this.name+"/"+this.sessid};Transport.prototype.ready=function(socket,fn){fn.call(this)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io,global){exports.Socket=Socket;function Socket(options){this.options={port:80,secure:false,document:"document"in global?document:false,resource:"socket.io",transports:io.transports,"connect timeout":1e4,"try multiple transports":true,reconnect:true,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":false,"auto connect":true,"flash policy port":10843,manualFlush:false};io.util.merge(this.options,options);this.connected=false;this.open=false;this.connecting=false;this.reconnecting=false;this.namespaces={};this.buffer=[];this.doBuffer=false;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||io.util.ua.hasCORS)){var self=this;io.util.on(global,"beforeunload",function(){self.disconnectSync()},false)}if(this.options["auto connect"]){this.connect()}}io.util.mixin(Socket,io.EventEmitter);Socket.prototype.of=function(name){if(!this.namespaces[name]){this.namespaces[name]=new io.SocketNamespace(this,name);if(name!==""){this.namespaces[name].packet({type:"connect"})}}return this.namespaces[name]};Socket.prototype.publish=function(){this.emit.apply(this,arguments);var nsp;for(var i in this.namespaces){if(this.namespaces.hasOwnProperty(i)){nsp=this.of(i);nsp.$emit.apply(nsp,arguments)}}};function empty(){}Socket.prototype.handshake=function(fn){var self=this,options=this.options;function complete(data){if(data instanceof Error){self.connecting=false;self.onError(data.message)}else{fn.apply(null,data.split(":"))}}var url=["http"+(options.secure?"s":"")+":/",options.host+":"+options.port,options.resource,io.protocol,io.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!io.util.ua.hasCORS){var insertAt=document.getElementsByTagName("script")[0],script=document.createElement("script");script.src=url+"&jsonp="+io.j.length;insertAt.parentNode.insertBefore(script,insertAt);io.j.push(function(data){complete(data);script.parentNode.removeChild(script)})}else{var xhr=io.util.request();xhr.open("GET",url,true);if(this.isXDomain()){xhr.withCredentials=true}xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty;if(xhr.status==200){complete(xhr.responseText)}else if(xhr.status==403){self.onError(xhr.responseText)}else{self.connecting=false;!self.reconnecting&&self.onError(xhr.responseText)}}};xhr.send(null)}};Socket.prototype.getTransport=function(override){var transports=override||this.transports,match;for(var i=0,transport;transport=transports[i];i++){if(io.Transport[transport]&&io.Transport[transport].check(this)&&(!this.isXDomain()||io.Transport[transport].xdomainCheck(this))){return new io.Transport[transport](this,this.sessionid)}}return null};Socket.prototype.connect=function(fn){if(this.connecting){return this}var self=this;self.connecting=true;this.handshake(function(sid,heartbeat,close,transports){self.sessionid=sid;self.closeTimeout=close*1e3;self.heartbeatTimeout=heartbeat*1e3;if(!self.transports)self.transports=self.origTransports=transports?io.util.intersect(transports.split(","),self.options.transports):self.options.transports;self.setHeartbeatTimeout();function connect(transports){if(self.transport)self.transport.clearTimeouts();self.transport=self.getTransport(transports);if(!self.transport)return self.publish("connect_failed");self.transport.ready(self,function(){self.connecting=true;self.publish("connecting",self.transport.name);self.transport.open();if(self.options["connect timeout"]){self.connectTimeoutTimer=setTimeout(function(){if(!self.connected){self.connecting=false;if(self.options["try multiple transports"]){var remaining=self.transports;while(remaining.length>0&&remaining.splice(0,1)[0]!=self.transport.name){}if(remaining.length){connect(remaining)}else{self.publish("connect_failed")}}}},self.options["connect timeout"])}})}connect(self.transports);self.once("connect",function(){clearTimeout(self.connectTimeoutTimer);fn&&typeof fn=="function"&&fn()})});return this};Socket.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var self=this;this.heartbeatTimeoutTimer=setTimeout(function(){self.transport.onClose()},this.heartbeatTimeout)};Socket.prototype.packet=function(data){if(this.connected&&!this.doBuffer){this.transport.packet(data)}else{this.buffer.push(data)}return this};Socket.prototype.setBuffer=function(v){this.doBuffer=v;if(!v&&this.connected&&this.buffer.length){if(!this.options["manualFlush"]){this.flushBuffer()}}};Socket.prototype.flushBuffer=function(){this.transport.payload(this.buffer);this.buffer=[]
};Socket.prototype.disconnect=function(){if(this.connected||this.connecting){if(this.open){this.of("").packet({type:"disconnect"})}this.onDisconnect("booted")}return this};Socket.prototype.disconnectSync=function(){var xhr=io.util.request();var uri=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,io.protocol,"",this.sessionid].join("/")+"/?disconnect=1";xhr.open("GET",uri,false);xhr.send(null);this.onDisconnect("booted")};Socket.prototype.isXDomain=function(){var port=global.location.port||("https:"==global.location.protocol?443:80);return this.options.host!==global.location.hostname||this.options.port!=port};Socket.prototype.onConnect=function(){if(!this.connected){this.connected=true;this.connecting=false;if(!this.doBuffer){this.setBuffer(false)}this.emit("connect")}};Socket.prototype.onOpen=function(){this.open=true};Socket.prototype.onClose=function(){this.open=false;clearTimeout(this.heartbeatTimeoutTimer)};Socket.prototype.onPacket=function(packet){this.of(packet.endpoint).onPacket(packet)};Socket.prototype.onError=function(err){if(err&&err.advice){if(err.advice==="reconnect"&&(this.connected||this.connecting)){this.disconnect();if(this.options.reconnect){this.reconnect()}}}this.publish("error",err&&err.reason?err.reason:err)};Socket.prototype.onDisconnect=function(reason){var wasConnected=this.connected,wasConnecting=this.connecting;this.connected=false;this.connecting=false;this.open=false;if(wasConnected||wasConnecting){this.transport.close();this.transport.clearTimeouts();if(wasConnected){this.publish("disconnect",reason);if("booted"!=reason&&this.options.reconnect&&!this.reconnecting){this.reconnect()}}}};Socket.prototype.reconnect=function(){this.reconnecting=true;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var self=this,maxAttempts=this.options["max reconnection attempts"],tryMultiple=this.options["try multiple transports"],limit=this.options["reconnection limit"];function reset(){if(self.connected){for(var i in self.namespaces){if(self.namespaces.hasOwnProperty(i)&&""!==i){self.namespaces[i].packet({type:"connect"})}}self.publish("reconnect",self.transport.name,self.reconnectionAttempts)}clearTimeout(self.reconnectionTimer);self.removeListener("connect_failed",maybeReconnect);self.removeListener("connect",maybeReconnect);self.reconnecting=false;delete self.reconnectionAttempts;delete self.reconnectionDelay;delete self.reconnectionTimer;delete self.redoTransports;self.options["try multiple transports"]=tryMultiple}function maybeReconnect(){if(!self.reconnecting){return}if(self.connected){return reset()}if(self.connecting&&self.reconnecting){return self.reconnectionTimer=setTimeout(maybeReconnect,1e3)}if(self.reconnectionAttempts++>=maxAttempts){if(!self.redoTransports){self.on("connect_failed",maybeReconnect);self.options["try multiple transports"]=true;self.transports=self.origTransports;self.transport=self.getTransport();self.redoTransports=true;self.connect()}else{self.publish("reconnect_failed");reset()}}else{if(self.reconnectionDelay<limit){self.reconnectionDelay*=2}self.connect();self.publish("reconnecting",self.reconnectionDelay,self.reconnectionAttempts);self.reconnectionTimer=setTimeout(maybeReconnect,self.reconnectionDelay)}}this.options["try multiple transports"]=false;this.reconnectionTimer=setTimeout(maybeReconnect,this.reconnectionDelay);this.on("connect",maybeReconnect)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io){exports.SocketNamespace=SocketNamespace;function SocketNamespace(socket,name){this.socket=socket;this.name=name||"";this.flags={};this.json=new Flag(this,"json");this.ackPackets=0;this.acks={}}io.util.mixin(SocketNamespace,io.EventEmitter);SocketNamespace.prototype.$emit=io.EventEmitter.prototype.emit;SocketNamespace.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};SocketNamespace.prototype.packet=function(packet){packet.endpoint=this.name;this.socket.packet(packet);this.flags={};return this};SocketNamespace.prototype.send=function(data,fn){var packet={type:this.flags.json?"json":"message",data:data};if("function"==typeof fn){packet.id=++this.ackPackets;packet.ack=true;this.acks[packet.id]=fn}return this.packet(packet)};SocketNamespace.prototype.emit=function(name){var args=Array.prototype.slice.call(arguments,1),lastArg=args[args.length-1],packet={type:"event",name:name};if("function"==typeof lastArg){packet.id=++this.ackPackets;packet.ack="data";this.acks[packet.id]=lastArg;args=args.slice(0,args.length-1)}packet.args=args;return this.packet(packet)};SocketNamespace.prototype.disconnect=function(){if(this.name===""){this.socket.disconnect()}else{this.packet({type:"disconnect"});this.$emit("disconnect")}return this};SocketNamespace.prototype.onPacket=function(packet){var self=this;function ack(){self.packet({type:"ack",args:io.util.toArray(arguments),ackId:packet.id})}switch(packet.type){case"connect":this.$emit("connect");break;case"disconnect":if(this.name===""){this.socket.onDisconnect(packet.reason||"booted")}else{this.$emit("disconnect",packet.reason)}break;case"message":case"json":var params=["message",packet.data];if(packet.ack=="data"){params.push(ack)}else if(packet.ack){this.packet({type:"ack",ackId:packet.id})}this.$emit.apply(this,params);break;case"event":var params=[packet.name].concat(packet.args);if(packet.ack=="data")params.push(ack);this.$emit.apply(this,params);break;case"ack":if(this.acks[packet.ackId]){this.acks[packet.ackId].apply(this,packet.args);delete this.acks[packet.ackId]}break;case"error":if(packet.advice){this.socket.onError(packet)}else{if(packet.reason=="unauthorized"){this.$emit("connect_failed",packet.reason)}else{this.$emit("error",packet.reason)}}break}};function Flag(nsp,name){this.namespace=nsp;this.name=name}Flag.prototype.send=function(){this.namespace.flags[this.name]=true;this.namespace.send.apply(this.namespace,arguments)};Flag.prototype.emit=function(){this.namespace.flags[this.name]=true;this.namespace.emit.apply(this.namespace,arguments)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io,global){exports.websocket=WS;function WS(socket){io.Transport.apply(this,arguments)}io.util.inherit(WS,io.Transport);WS.prototype.name="websocket";WS.prototype.open=function(){var query=io.util.query(this.socket.options.query),self=this,Socket;if(!Socket){Socket=global.MozWebSocket||global.WebSocket}this.websocket=new Socket(this.prepareUrl()+query);this.websocket.onopen=function(){self.onOpen();self.socket.setBuffer(false)};this.websocket.onmessage=function(ev){self.onData(ev.data)};this.websocket.onclose=function(){self.onClose();self.socket.setBuffer(true)};this.websocket.onerror=function(e){self.onError(e)};return this};if(io.util.ua.iDevice){WS.prototype.send=function(data){var self=this;setTimeout(function(){self.websocket.send(data)},0);return this}}else{WS.prototype.send=function(data){this.websocket.send(data);return this}}WS.prototype.payload=function(arr){for(var i=0,l=arr.length;i<l;i++){this.packet(arr[i])}return this};WS.prototype.close=function(){this.websocket.close();return this};WS.prototype.onError=function(e){this.socket.onError(e)};WS.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};WS.check=function(){return"WebSocket"in global&&!("__addTask"in WebSocket)||"MozWebSocket"in global};WS.xdomainCheck=function(){return true};io.transports.push("websocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io){exports.flashsocket=Flashsocket;function Flashsocket(){io.Transport.websocket.apply(this,arguments)}io.util.inherit(Flashsocket,io.Transport.websocket);Flashsocket.prototype.name="flashsocket";Flashsocket.prototype.open=function(){var self=this,args=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.open.apply(self,args)});return this};Flashsocket.prototype.send=function(){var self=this,args=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.send.apply(self,args)});return this};Flashsocket.prototype.close=function(){WebSocket.__tasks.length=0;io.Transport.websocket.prototype.close.call(this);return this};Flashsocket.prototype.ready=function(socket,fn){function init(){var options=socket.options,port=options["flash policy port"],path=["http"+(options.secure?"s":"")+":/",options.host+":"+options.port,options.resource,"static/flashsocket","WebSocketMain"+(socket.isXDomain()?"Insecure":"")+".swf"];if(!Flashsocket.loaded){if(typeof WEB_SOCKET_SWF_LOCATION==="undefined"){WEB_SOCKET_SWF_LOCATION=path.join("/")}if(port!==843){WebSocket.loadFlashPolicyFile("xmlsocket://"+options.host+":"+port)}WebSocket.__initialize();Flashsocket.loaded=true}fn.call(self)}var self=this;if(document.body)return init();io.util.load(init)};Flashsocket.check=function(){if(typeof WebSocket=="undefined"||!("__initialize"in WebSocket)||!swfobject)return false;return swfobject.getFlashPlayerVersion().major>=10};Flashsocket.xdomainCheck=function(){return true};if(typeof window!="undefined"){WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=true}io.transports.push("flashsocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);if("undefined"!=typeof window){var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O[["Active"].concat("Object").join("X")]!=D){try{var ad=new(window[["Active"].concat("Object").join("X")])(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if(typeof j.readyState!=D&&j.readyState=="complete"||typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body)){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return!a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||!/%$/.test(aa.width)&&parseInt(aa.width,10)<310){aa.width="310"}if(typeof aa.height==D||!/%$/.test(aa.height)&&parseInt(aa.height,10)<137){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?["Active"].concat("").join("X"):"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return Y[0]>X[0]||Y[0]==X[0]&&Y[1]>X[1]||Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=ad&&typeof ad=="string"?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring(Y[X].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}()}(function(){if("undefined"==typeof window||window.WebSocket)return;var console=window.console;if(!console||!console.log||!console.error){console={log:function(){},error:function(){}}}if(!swfobject.hasFlashPlayerVersion("10.0.0")){console.error("Flash Player >= 10.0.0 is required.");return}if(location.protocol=="file:"){console.error("WARNING: web-socket-js doesn't work in file:///... URL "+"unless you set Flash Security Settings properly. "+"Open the page via Web server i.e. http://...")}WebSocket=function(url,protocols,proxyHost,proxyPort,headers){var self=this;self.__id=WebSocket.__nextId++;WebSocket.__instances[self.__id]=self;self.readyState=WebSocket.CONNECTING;self.bufferedAmount=0;self.__events={};if(!protocols){protocols=[]}else if(typeof protocols=="string"){protocols=[protocols]}setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(self.__id,url,protocols,proxyHost||null,proxyPort||0,headers||null)})},0)};WebSocket.prototype.send=function(data){if(this.readyState==WebSocket.CONNECTING){throw"INVALID_STATE_ERR: Web Socket connection has not been established"}var result=WebSocket.__flash.send(this.__id,encodeURIComponent(data));if(result<0){return true}else{this.bufferedAmount+=result;return false}};WebSocket.prototype.close=function(){if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING){return}this.readyState=WebSocket.CLOSING;WebSocket.__flash.close(this.__id)};WebSocket.prototype.addEventListener=function(type,listener,useCapture){if(!(type in this.__events)){this.__events[type]=[]}this.__events[type].push(listener)};WebSocket.prototype.removeEventListener=function(type,listener,useCapture){if(!(type in this.__events))return;var events=this.__events[type];for(var i=events.length-1;i>=0;--i){if(events[i]===listener){events.splice(i,1);break}}};WebSocket.prototype.dispatchEvent=function(event){var events=this.__events[event.type]||[];for(var i=0;i<events.length;++i){events[i](event)}var handler=this["on"+event.type];if(handler)handler(event)};WebSocket.prototype.__handleEvent=function(flashEvent){if("readyState"in flashEvent){this.readyState=flashEvent.readyState}if("protocol"in flashEvent){this.protocol=flashEvent.protocol}var jsEvent;if(flashEvent.type=="open"||flashEvent.type=="error"){jsEvent=this.__createSimpleEvent(flashEvent.type)}else if(flashEvent.type=="close"){jsEvent=this.__createSimpleEvent("close")}else if(flashEvent.type=="message"){var data=decodeURIComponent(flashEvent.message);jsEvent=this.__createMessageEvent("message",data)}else{throw"unknown event type: "+flashEvent.type}this.dispatchEvent(jsEvent)};WebSocket.prototype.__createSimpleEvent=function(type){if(document.createEvent&&window.Event){var event=document.createEvent("Event");event.initEvent(type,false,false);return event}else{return{type:type,bubbles:false,cancelable:false}}};WebSocket.prototype.__createMessageEvent=function(type,data){if(document.createEvent&&window.MessageEvent&&!window.opera){var event=document.createEvent("MessageEvent");event.initMessageEvent("message",false,false,data,null,null,window,null);return event}else{return{type:type,data:data,bubbles:false,cancelable:false}}};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__flash=null;WebSocket.__instances={};WebSocket.__tasks=[];WebSocket.__nextId=0;WebSocket.loadFlashPolicyFile=function(url){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(url)})};WebSocket.__initialize=function(){if(WebSocket.__flash)return;if(WebSocket.__swfLocation){window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation}if(!window.WEB_SOCKET_SWF_LOCATION){console.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}var container=document.createElement("div");container.id="webSocketContainer";container.style.position="absolute";if(WebSocket.__isFlashLite()){container.style.left="0px";container.style.top="0px"}else{container.style.left="-100px";container.style.top="-100px"}var holder=document.createElement("div");holder.id="webSocketFlash";container.appendChild(holder);document.body.appendChild(container);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:"always"},null,function(e){if(!e.success){console.error("[WebSocket] swfobject.embedSWF failed")}})};WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var i=0;i<WebSocket.__tasks.length;++i){WebSocket.__tasks[i]()}WebSocket.__tasks=[]},0)};WebSocket.__onFlashEvent=function(){setTimeout(function(){try{var events=WebSocket.__flash.receiveEvents();for(var i=0;i<events.length;++i){WebSocket.__instances[events[i].webSocketId].__handleEvent(events[i])}}catch(e){console.error(e)}},0);return true};WebSocket.__log=function(message){console.log(decodeURIComponent(message))};WebSocket.__error=function(message){console.error(decodeURIComponent(message))};WebSocket.__addTask=function(task){if(WebSocket.__flash){task()}else{WebSocket.__tasks.push(task)}};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes){return false}var mimeType=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!mimeType||!mimeType.enabledPlugin||!mimeType.enabledPlugin.filename){return false}return mimeType.enabledPlugin.filename.match(/flashlite/i)?true:false};if(!window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION){if(window.addEventListener){window.addEventListener("load",function(){WebSocket.__initialize()},false)}else{window.attachEvent("onload",function(){WebSocket.__initialize()})}}})();(function(exports,io,global){exports.XHR=XHR;function XHR(socket){if(!socket)return;io.Transport.apply(this,arguments);this.sendBuffer=[]}io.util.inherit(XHR,io.Transport);XHR.prototype.open=function(){this.socket.setBuffer(false);this.onOpen();this.get();this.setCloseTimeout();return this};XHR.prototype.payload=function(payload){var msgs=[];for(var i=0,l=payload.length;i<l;i++){msgs.push(io.parser.encodePacket(payload[i]))}this.send(io.parser.encodePayload(msgs))};XHR.prototype.send=function(data){this.post(data);return this};function empty(){}XHR.prototype.post=function(data){var self=this;this.socket.setBuffer(true);function stateChange(){if(this.readyState==4){this.onreadystatechange=empty;self.posting=false;if(this.status==200){self.socket.setBuffer(false)}else{self.onClose()}}}function onload(){this.onload=empty;self.socket.setBuffer(false)}this.sendXHR=this.request("POST");if(global.XDomainRequest&&this.sendXHR instanceof XDomainRequest){this.sendXHR.onload=this.sendXHR.onerror=onload}else{this.sendXHR.onreadystatechange=stateChange}this.sendXHR.send(data)};XHR.prototype.close=function(){this.onClose();return this};XHR.prototype.request=function(method){var req=io.util.request(this.socket.isXDomain()),query=io.util.query(this.socket.options.query,"t="+ +new Date);req.open(method||"GET",this.prepareUrl()+query,true);if(method=="POST"){try{if(req.setRequestHeader){req.setRequestHeader("Content-type","text/plain;charset=UTF-8")}else{req.contentType="text/plain"}}catch(e){}}return req};XHR.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};XHR.check=function(socket,xdomain){try{var request=io.util.request(xdomain),usesXDomReq=global.XDomainRequest&&request instanceof XDomainRequest,socketProtocol=socket&&socket.options&&socket.options.secure?"https:":"http:",isXProtocol=global.location&&socketProtocol!=global.location.protocol;if(request&&!(usesXDomReq&&isXProtocol)){return true}}catch(e){}return false};XHR.xdomainCheck=function(socket){return XHR.check(socket,true)}})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io){exports.htmlfile=HTMLFile;function HTMLFile(socket){io.Transport.XHR.apply(this,arguments)}io.util.inherit(HTMLFile,io.Transport.XHR);HTMLFile.prototype.name="htmlfile";HTMLFile.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var iframeC=this.doc.createElement("div");iframeC.className="socketio";this.doc.body.appendChild(iframeC);this.iframe=this.doc.createElement("iframe");iframeC.appendChild(this.iframe);var self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+query;io.util.on(window,"unload",function(){self.destroy()})};HTMLFile.prototype._=function(data,doc){data=data.replace(/\\\//g,"/");this.onData(data);try{var script=doc.getElementsByTagName("script")[0];script.parentNode.removeChild(script)}catch(e){}};HTMLFile.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};HTMLFile.prototype.close=function(){this.destroy();return io.Transport.XHR.prototype.close.call(this)};HTMLFile.check=function(socket){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window){try{var a=new(window[["Active"].concat("Object").join("X")])("htmlfile");return a&&io.Transport.XHR.check(socket)}catch(e){}}return false};HTMLFile.xdomainCheck=function(){return false};io.transports.push("htmlfile")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,io,global){exports["xhr-polling"]=XHRPolling;function XHRPolling(){io.Transport.XHR.apply(this,arguments)}io.util.inherit(XHRPolling,io.Transport.XHR);io.util.merge(XHRPolling,io.Transport.XHR);XHRPolling.prototype.name="xhr-polling";XHRPolling.prototype.heartbeats=function(){return false};XHRPolling.prototype.open=function(){var self=this;io.Transport.XHR.prototype.open.call(self);return false};function empty(){}XHRPolling.prototype.get=function(){if(!this.isOpen)return;var self=this;function stateChange(){if(this.readyState==4){this.onreadystatechange=empty;if(this.status==200){self.onData(this.responseText);self.get()}else{self.onClose()}}}function onload(){this.onload=empty;this.onerror=empty;self.retryCounter=1;self.onData(this.responseText);self.get()}function onerror(){self.retryCounter++;if(!self.retryCounter||self.retryCounter>3){self.onClose()}else{self.get()}}this.xhr=this.request();if(global.XDomainRequest&&this.xhr instanceof XDomainRequest){this.xhr.onload=onload;this.xhr.onerror=onerror}else{this.xhr.onreadystatechange=stateChange}this.xhr.send(null)};XHRPolling.prototype.onClose=function(){io.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=empty;try{this.xhr.abort()}catch(e){}this.xhr=null}};XHRPolling.prototype.ready=function(socket,fn){var self=this;io.util.defer(function(){fn.call(self)})};io.transports.push("xhr-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(exports,io,global){var indicator=global.document&&"MozAppearance"in global.document.documentElement.style;exports["jsonp-polling"]=JSONPPolling;function JSONPPolling(socket){io.Transport["xhr-polling"].apply(this,arguments);this.index=io.j.length;var self=this;io.j.push(function(msg){self._(msg)})}io.util.inherit(JSONPPolling,io.Transport["xhr-polling"]);JSONPPolling.prototype.name="jsonp-polling";JSONPPolling.prototype.post=function(data){var self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="socketio_iframe_"+this.index,iframe;form.className="socketio";form.style.position="absolute";form.style.top="0px";form.style.left="0px";form.style.display="none";form.target=id;form.method="POST";form.setAttribute("accept-charset","utf-8");area.name="d";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.prepareUrl()+query;function complete(){initIframe();self.socket.setBuffer(false)}function initIframe(){if(self.iframe){self.form.removeChild(self.iframe)}try{iframe=document.createElement('<iframe name="'+self.iframeId+'">')}catch(e){iframe=document.createElement("iframe");iframe.name=self.iframeId
}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();this.area.value=io.JSON.stringify(data);try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){iframe.onreadystatechange=function(){if(self.iframe.readyState=="complete"){complete()}}}else{this.iframe.onload=complete}this.socket.setBuffer(true)};JSONPPolling.prototype.get=function(){var self=this,script=document.createElement("script"),query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.prepareUrl()+query;script.onerror=function(){self.onClose()};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt);this.script=script;if(indicator){setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype._=function(msg){this.onData(msg);if(this.isOpen){this.get()}return this};JSONPPolling.prototype.ready=function(socket,fn){var self=this;if(!indicator)return fn.call(this);io.util.load(function(){fn.call(self)})};JSONPPolling.check=function(){return"document"in global};JSONPPolling.xdomainCheck=function(){return true};io.transports.push("jsonp-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);if(typeof define==="function"&&define.amd){define([],function(){return io})}})()},{}],31:[function(require,module,exports){var blueprints={};module.exports=function(){return{add:function(blueprint){if(!blueprint.fields){if(typeof blueprint.find==="function"){blueprint.fields=blueprint.find("field").models}else{blueprint.fields=[]}}blueprints[blueprint.title()]=blueprint;return this},get:function(name){if(arguments.length<=0){return blueprints}return blueprints[name]},all:function(){var ret={};for(var prop in blueprints){ret[prop]=blueprints[prop]}return ret},create:function(name){var blueprint=this.get(name);if(!blueprint){return $digger.create(name,{})}var data=blueprint?{_digger:{tag:blueprint.attr("tag")||blueprint.attr("name"),"class":blueprint.attr("class")||[]}}:{};blueprint.find("field").each(function(field){var name=field.attr("name");var def=field.attr("default");if(def){data[name]=def}});var container=$digger.create([data]);container.data("new",true);return container}}}},{}],"digger-sockets":[function(require,module,exports){module.exports=require("E9YBgr")},{}],E9YBgr:[function(require,module,exports){var utils=require("digger-utils");var Client=require("digger-client");var Sockets=require("socket.io-client");var Blueprint=require("./blueprints");var Template=require("./templates");module.exports=function(config){config=config||{};if(config.debug){console.log("-------------------------------------------");console.log("-------------------------------------------");console.log("CONFIG");console.dir(config)}var connecturl="//"+(config.host||"localhost");var socket=Sockets.connect(connecturl);var request_buffer=[];function disconnected_handler(req,reply){request_buffer.push({req:req,reply:reply})}function padding(offset){offset=offset||0;var st="";for(var i=0;i<offset;i++){st+="    "}return st}function is_contract(req){return req.url=="/reception"&&req.method=="post"}function log_contract(contract,offset){console.log(padding(offset)+"-------------------------------------------");console.log(padding(offset)+"contract: "+contract.headers["x-contract-type"]);offset++;var summary=[];(contract.body||[]).forEach(function(child){summary.push(log_request(child,offset))});return"contract: "+summary.join(" "+contract.headers["x-contract-type"]+" ")}function log_warehouse_request(req,offset){var extra="";if(req.headers["x-json-selector"]){var selector=req.headers["x-json-selector"];extra=" - select: "+selector.string}var summary="request: "+req.method+" "+req.url+extra;console.log(padding(offset)+"-------------------------------------------");console.log(padding(offset)+summary);return summary}function log_request(packet,offset){offset=offset||0;var summary="";if(is_contract(packet)){summary=log_contract(packet,offset)}else{summary=log_warehouse_request(packet,offset)}return summary}function log_response_factory(summary){return function(answer){var extra="";if(answer.error){extra="ERROR: "+answer.error}else{extra=summary}console.log("-------------------------------------------");console.log("ANSWER");console.log(extra);console.log("-------------------------------------------");console.dir(answer.results);console.log("-------------------------------------------")}}var run_socket=disconnected_handler;socket.on("connect",function(){var callbacks={};run_socket=function(req,reply){var http_req={id:utils.littleid(),method:req.method,url:req.url,headers:req.headers,body:req.body};var log_response=null;if($digger.config.debug){log_response=log_response_factory(log_request(req))}callbacks[http_req.id]=function(answer){var error=answer.error;var results=answer.results;reply(error,results);if($digger.config.debug){log_response(answer)}delete callbacks[http_req.id]};socket.emit("request",http_req)};socket.on("response",function(answer){var id=answer.id;var callback=callbacks[id];if(callback){callback(answer)}});request_buffer.forEach(function(buffered_request){run_socket(buffered_request.req,buffered_request.reply)});request_buffer=[];socket.on("disconnect",function(){run_socket=disconnected_handler})});function handle(req,reply){run_socket(req,reply)}var $digger=Client(handle);$digger.config=config;$digger.user=config.user;$digger.blueprint=Blueprint();$digger.template=Template();return $digger}},{"./blueprints":31,"./templates":34,"digger-client":26,"digger-utils":29,"socket.io-client":30}],34:[function(require,module,exports){var templates={};module.exports=function(){return{add:function(name,plate){templates[name]=plate;return this},get:function(name){if(arguments.length<=0){return templates}return templates[name]}}}},{}],35:[function(require,module,exports){var process=require("__browserify_process");if(!process.EventEmitter)process.EventEmitter=function(){};var EventEmitter=exports.EventEmitter=process.EventEmitter;var isArray=typeof Array.isArray==="function"?Array.isArray:function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function indexOf(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(x===xs[i])return i}return-1}var defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!this._events)this._events={};this._events.maxListeners=n};EventEmitter.prototype.emit=function(type){if(type==="error"){if(!this._events||!this._events.error||isArray(this._events.error)&&!this._events.error.length){if(arguments[1]instanceof Error){throw arguments[1]}else{throw new Error("Uncaught, unspecified 'error' event.")}return false}}if(!this._events)return false;var handler=this._events[type];if(!handler)return false;if(typeof handler=="function"){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:var args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}return true}else if(isArray(handler)){var args=Array.prototype.slice.call(arguments,1);var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}return true}else{return false}};EventEmitter.prototype.addListener=function(type,listener){if("function"!==typeof listener){throw new Error("addListener only takes instances of Function")}if(!this._events)this._events={};this.emit("newListener",type,listener);if(!this._events[type]){this._events[type]=listener}else if(isArray(this._events[type])){if(!this._events[type].warned){var m;if(this._events.maxListeners!==undefined){m=this._events.maxListeners}else{m=defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);console.trace()}}this._events[type].push(listener)}else{this._events[type]=[this._events[type],listener]}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){var self=this;self.on(type,function g(){self.removeListener(type,g);listener.apply(this,arguments)});return this};EventEmitter.prototype.removeListener=function(type,listener){if("function"!==typeof listener){throw new Error("removeListener only takes instances of Function")}if(!this._events||!this._events[type])return this;var list=this._events[type];if(isArray(list)){var i=indexOf(list,listener);if(i<0)return this;list.splice(i,1);if(list.length==0)delete this._events[type]}else if(this._events[type]===listener){delete this._events[type]}return this};EventEmitter.prototype.removeAllListeners=function(type){if(arguments.length===0){this._events={};return this}if(type&&this._events&&this._events[type])this._events[type]=null;return this};EventEmitter.prototype.listeners=function(type){if(!this._events)this._events={};if(!this._events[type])this._events[type]=[];if(!isArray(this._events[type])){this._events[type]=[this._events[type]]}return this._events[type]};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(typeof emitter._events[type]==="function")ret=1;else ret=emitter._events[type].length;return ret}},{__browserify_process:37}],36:[function(require,module,exports){var events=require("events");exports.isArray=isArray;exports.isDate=function(obj){return Object.prototype.toString.call(obj)==="[object Date]"};exports.isRegExp=function(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"};exports.print=function(){};exports.puts=function(){};exports.debug=function(){};exports.inspect=function(obj,showHidden,depth,colors){var seen=[];var stylize=function(str,styleType){var styles={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};var style={special:"cyan",number:"blue","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"}[styleType];if(style){return"["+styles[style][0]+"m"+str+"["+styles[style][1]+"m"}else{return str}};if(!colors){stylize=function(str,styleType){return str}}function format(value,recurseTimes){if(value&&typeof value.inspect==="function"&&value!==exports&&!(value.constructor&&value.constructor.prototype===value)){return value.inspect(recurseTimes)}switch(typeof value){case"undefined":return stylize("undefined","undefined");case"string":var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(simple,"string");case"number":return stylize(""+value,"number");case"boolean":return stylize(""+value,"boolean")}if(value===null){return stylize("null","null")}var visible_keys=Object_keys(value);var keys=showHidden?Object_getOwnPropertyNames(value):visible_keys;if(typeof value==="function"&&keys.length===0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{var name=value.name?": "+value.name:"";return stylize("[Function"+name+"]","special")}}if(isDate(value)&&keys.length===0){return stylize(value.toUTCString(),"date")}var base,type,braces;if(isArray(value)){type="Array";braces=["[","]"]}else{type="Object";braces=["{","}"]}if(typeof value==="function"){var n=value.name?": "+value.name:"";base=isRegExp(value)?" "+value:" [Function"+n+"]"}else{base=""}if(isDate(value)){base=" "+value.toUTCString()}if(keys.length===0){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{return stylize("[Object]","special")}}seen.push(value);var output=keys.map(function(key){var name,str;if(value.__lookupGetter__){if(value.__lookupGetter__(key)){if(value.__lookupSetter__(key)){str=stylize("[Getter/Setter]","special")}else{str=stylize("[Getter]","special")}}else{if(value.__lookupSetter__(key)){str=stylize("[Setter]","special")}}}if(visible_keys.indexOf(key)<0){name="["+key+"]"}if(!str){if(seen.indexOf(value[key])<0){if(recurseTimes===null){str=format(value[key])}else{str=format(value[key],recurseTimes-1)}if(str.indexOf("\n")>-1){if(isArray(value)){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=stylize("[Circular]","special")}}if(typeof name==="undefined"){if(type==="Array"&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=stylize(name,"string")}}return name+": "+str});seen.pop();var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.length+1},0);if(length>50){output=braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}else{output=braces[0]+base+" "+output.join(", ")+" "+braces[1]}return output}return format(obj,typeof depth==="undefined"?2:depth)};function isArray(ar){return Array.isArray(ar)||typeof ar==="object"&&Object.prototype.toString.call(ar)==="[object Array]"}function isRegExp(re){typeof re==="object"&&Object.prototype.toString.call(re)==="[object RegExp]"}function isDate(d){return typeof d==="object"&&Object.prototype.toString.call(d)==="[object Date]"}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(msg){};exports.pump=null;var Object_keys=Object.keys||function(obj){var res=[];for(var key in obj)res.push(key);return res};var Object_getOwnPropertyNames=Object.getOwnPropertyNames||function(obj){var res=[];for(var key in obj){if(Object.hasOwnProperty.call(obj,key))res.push(key)}return res};var Object_create=Object.create||function(prototype,properties){var object;if(prototype===null){object={__proto__:null}}else{if(typeof prototype!=="object"){throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'")}var Type=function(){};Type.prototype=prototype;object=new Type;object.__proto__=prototype}if(typeof properties!=="undefined"&&Object.defineProperties){Object.defineProperties(object,properties)}return object};exports.inherits=function(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object_create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})};var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(typeof f!=="string"){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(exports.inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":return JSON.stringify(args[i++]);default:return x}});for(var x=args[i];i<len;x=args[++i]){if(x===null||typeof x!=="object"){str+=" "+x}else{str+=" "+exports.inspect(x)}}return str}},{events:35}],37:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){if(ev.source===window&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}]},{},[]);